<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù‚Ø·Ø§Ø± Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');

        :root {
            --primary: #006633;
            --secondary: #D21034;
            --bg: #f0f7f4;
            --white: #ffffff;
            --track-color: #cbd5e0;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg);
            color: #333;
            margin: 0;
            padding: 0;
            height: 100vh;
            height: 100dvh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- 1. Ø§Ù„Ø±Ø£Ø³ --- */
        header {
            background: var(--white);
            padding: 5px 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            z-index: 10;
            border-bottom: 3px solid var(--secondary);
        }
        
        .game-title h1 { margin: 0; font-size: 1rem; color: var(--primary); font-weight: 900; }
        .game-title small { font-size: 0.65rem; color: #777; }

        .lives-badge {
            background: #fff0f0; color: var(--secondary);
            padding: 4px 10px; border-radius: 20px;
            font-weight: bold; font-size: 0.8rem;
            display: flex; align-items: center; gap: 5px;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.05);
        }

        /* --- 2. Ø´Ø±ÙŠØ· Ø§Ù„Ù‚Ø·Ø§Ø± Ø§Ù„Ù…Ù…ØªØ¹ (ØªØµÙ…ÙŠÙ… Ø¬Ø¯ÙŠØ¯) --- */
        .train-container {
            background: linear-gradient(to bottom, #e3f2fd, #bbdefb); /* Ù„ÙˆÙ† Ø³Ù…Ø§Ø¡ */
            padding: 20px 10px 10px 10px;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
            border-bottom: 2px solid #90caf9;
        }

        /* Ø§Ù„Ø³ÙƒØ© Ø§Ù„Ø­Ø¯ÙŠØ¯ÙŠØ© */
        .railway-track {
            width: 90%; margin: 0 auto; height: 8px;
            background: var(--track-color);
            border-radius: 4px; position: relative;
            display: flex; justify-content: space-between; align-items: center;
            flex-direction: row-reverse; /* Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† */
        }

        /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ù…Ù„ÙˆÙ† Ø§Ù„Ø°ÙŠ ÙŠÙ…Ù„Ø£ Ø§Ù„Ø³ÙƒØ© */
        .track-fill {
            position: absolute; right: 0; top: 0; bottom: 0;
            width: 0%; /* ÙŠØªØºÙŠØ± Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±Ø¨Øª */
            background: var(--primary);
            border-radius: 4px; transition: width 1s ease;
            z-index: 1;
        }

        /* Ø§Ù„Ù…Ø­Ø·Ø§Øª (Ø§Ù„Ù†Ù‚Ø§Ø·) */
        .station {
            width: 28px; height: 28px;
            background: var(--white); border: 3px solid var(--track-color);
            border-radius: 50%; z-index: 2;
            display: grid; place-items: center;
            font-weight: bold; font-size: 0.8rem; color: #999;
            transition: all 0.4s; position: relative;
        }
        .station.active {
            border-color: var(--primary); color: var(--primary);
            transform: scale(1.2); box-shadow: 0 0 10px rgba(0, 102, 51, 0.3);
            background: #fff;
        }
        .station.passed {
            background: var(--primary); border-color: var(--primary);
            color: white;
        }

        /* Ø§Ù„Ù‚Ø·Ø§Ø± Ø§Ù„Ù…ØªØ­Ø±Ùƒ */
        #train-mover {
            position: absolute; top: -25px; right: 0;
            font-size: 2.5rem; z-index: 5;
            transform: translateX(50%); /* Ù„Ø¶Ø¨Ø· Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø© */
            transition: right 1s cubic-bezier(0.5, 0, 0.2, 1);
            filter: drop-shadow(2px 4px 2px rgba(0,0,0,0.2));
            animation: bounceTrain 1s infinite alternate; /* Ø­Ø±ÙƒØ© Ù…Ø±Ø­Ø© */
        }

        @keyframes bounceTrain {
            0% { transform: translateX(50%) translateY(0); }
            100% { transform: translateX(50%) translateY(-3px); }
        }

        /* --- 3. Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨ --- */
        .play-area {
            flex-grow: 1; display: flex; flex-direction: column;
            overflow: hidden; position: relative;
        }

        /* Ø§Ù„ØªÙ…Ø±ÙŠØ± (Scroll) */
        .timeline-scroll {
            flex-grow: 1; overflow-y: auto; padding: 15px;
            padding-bottom: 20px; background: var(--bg);
        }

        .quest-box {
            background: white; border-radius: 15px; padding: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 10px;
            border-top: 4px solid var(--primary);
        }

        .context-note {
            background: #fff3e0; color: #e65100; font-size: 0.75rem;
            padding: 5px 10px; border-radius: 5px; margin-bottom: 10px;
            display: inline-block; font-weight: bold;
        }

        /* Ø§Ù„Ø®Ø§Ù†Ø§Øª */
        .slot {
            background: #fcfcfc; border: 2px dashed #ccc;
            border-radius: 10px; min-height: 60px; margin-bottom: 10px;
            display: flex; align-items: stretch; transition: 0.3s;
            opacity: 0.6; filter: grayscale(1);
        }
        .slot.active {
            opacity: 1; filter: grayscale(0); border-style: solid;
            border-color: var(--primary); background: white;
            transform: scale(1.02); box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .slot.filled {
            opacity: 1; filter: grayscale(0); border-style: solid;
            border-color: var(--primary); background: #e8f5e9;
        }

        .slot-label {
            width: 80px; background: #eee;
            display: grid; place-items: center;
            font-weight: bold; font-size: 0.75rem; color: #555;
            border-radius: 0 8px 8px 0;
        }
        .slot-content {
            flex-grow: 1; display: grid; place-items: center;
            padding: 5px; text-align: center; font-size: 0.85rem;
            color: var(--primary); font-weight: bold;
        }

        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ */
        .cards-deck {
            background: white; padding: 10px;
            border-top: 2px solid #eee; z-index: 20;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.05);
            flex-shrink: 0;
        }
        .deck-title { text-align: center; font-size: 0.8rem; color: #888; margin-bottom: 8px; }
        
        .cards-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 8px;
        }
        
        .card {
            background: white; border: 1px solid #ddd; border-bottom: 3px solid #ccc;
            border-radius: 10px; padding: 10px; text-align: center;
            font-size: 0.8rem; cursor: pointer; min-height: 50px;
            display: grid; place-items: center; transition: 0.1s;
        }
        .card:active { transform: translateY(2px); border-bottom-width: 1px; background: #f0f0f0; }

        /* ØªØ¹Ø¯ÙŠÙ„ Ù„Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± */
        @media (min-width: 768px) {
            .play-area { flex-direction: row; }
            .timeline-scroll { width: 60%; border-left: 1px solid #ddd; }
            .cards-deck { width: 40%; border-top: none; border-right: 2px solid #eee; overflow-y: auto; }
            .cards-grid { grid-template-columns: 1fr; }
            .card { padding: 15px; font-size: 0.95rem; }
        }

        /* --- Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© --- */
        .overlay {
            position: fixed; inset: 0; background: white; z-index: 100;
            display: none; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; padding: 20px;
        }
        .overlay.active { display: flex; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }

        /* Ø²Ø± Ø±Ø¦ÙŠØ³ÙŠ */
        .btn-main {
            background: var(--primary); color: white; border: none;
            padding: 12px 40px; border-radius: 50px; font-size: 1.1rem;
            font-weight: bold; cursor: pointer; margin-top: 20px;
            box-shadow: 0 5px 0 #004020; transition: transform 0.1s;
        }
        .btn-main:active { transform: translateY(4px); box-shadow: none; }

        /* Ù†Øµ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
        .info-card {
            background: #fff; padding: 25px; border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); max-width: 500px;
            border-top: 6px solid var(--secondary);
        }
        .info-list {
            text-align: right; margin: 20px 0; padding-right: 20px;
            list-style: none; color: #555;
        }
        .info-list li { margin-bottom: 10px; position: relative; }
        .info-list li::before { content: "ğŸ”¹"; position: absolute; right: -25px; font-size: 0.8rem;}

        /* ØªÙˆØ³Øª Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
        .toast {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.85); color: white; padding: 15px 30px;
            border-radius: 30px; display: none; z-index: 200; font-weight: bold;
        }

        /* ØªØ£Ø«ÙŠØ± Ø§Ù„ÙÙˆØ² */
        .confetti { font-size: 4rem; animation: spin 2s infinite linear; display: inline-block;}
        @keyframes spin { 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <div id="toast" class="toast"></div>

    <div id="start-screen" class="overlay active" style="background: linear-gradient(135deg, #f0f7f4, #fff);">
        <div class="info-card">
            <h1 style="color:var(--primary); font-size:1.8rem; margin-bottom:5px;">ğŸš‚ Ù‚Ø·Ø§Ø± Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„</h1>
            <h3 style="color:#555; margin:0; font-size:1.1rem;">Ù…Ø¸Ø§Ù‡Ø±Ø§Øª 11 Ø¯ÙŠØ³Ù…Ø¨Ø± 1960</h3>
            <div style="background:#eee; color:#666; font-size:0.8rem; padding:4px 12px; border-radius:15px; display:inline-block; margin-top:10px;">
                Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙƒØ§ØªØ¨ Ø­Ù…Ø§Ø¯ Ø¨Ù† Ø¹ÙŠØ³Ù‰
            </div>
            
          
            <ul class="info-list">
                <li>Ø§Ù„Ù„Ø¹Ø¨Ø© ØªØªÙƒÙˆÙ† Ù…Ù† <strong>4 Ù…Ø­Ø·Ø§Øª</strong> Ø±Ø¦ÙŠØ³ÙŠØ©.</li>
                <li>ÙŠØ¬Ø¨ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø£Ùˆ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ù„ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ù‚Ø·Ø§Ø±.</li>
                <li>Ù„Ø¯ÙŠÙƒ <strong>Ù…Ø­Ø§ÙˆÙ„ØªØ§Ù† (2)</strong> ÙÙ‚Ø· ÙÙŠ ÙƒÙ„ Ù…Ø­Ø·Ø©.</li>
                <li>Ø¥Ø°Ø§ ÙØ´Ù„Øª ÙÙŠ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„ØªÙŠÙ†ØŒ Ø³ØªØ®Ø³Ø± Ø§Ù„Ù„Ø¹Ø¨Ø© ÙˆÙŠØ¹ÙˆØ¯ Ø§Ù„Ù‚Ø·Ø§Ø± Ù„Ù„Ø¨Ø¯Ø§ÙŠØ©.</li>
            </ul>

            <button class="btn-main" onclick="Game.start()">Ø§Ù†Ø·Ù„Ù‚ Ø¨Ø§Ù„Ù‚Ø·Ø§Ø± ğŸš©</button>
        </div>
    </div>

    <div id="game-screen" class="overlay" style="background: var(--bg); display: none; justify-content: flex-start; padding: 0;">
        
        <header>
            <div class="game-title">
                <h1>Ù‚Ø·Ø§Ø± Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„</h1>
                <small>Ø­Ù…Ø§Ø¯ Ø¨Ù† Ø¹ÙŠØ³Ù‰</small>
            </div>
            <div class="lives-badge">
                <span>â¤ï¸</span> <span id="lives-count">2</span>
            </div>
        </header>

        <div class="train-container">
            <div class="railway-track">
                <div class="track-fill" id="track-fill"></div>
                
                <div class="station" id="st-4">4</div>
                <div class="station" id="st-3">3</div>
                <div class="station" id="st-2">2</div>
                <div class="station active" id="st-1">1</div>
                
                <div id="train-mover">ğŸš‚</div>
            </div>
        </div>

        <div class="play-area">
            <div class="timeline-scroll">
                <div class="quest-box">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span id="lvl-title" style="color:var(--primary); font-weight:bold; font-size:1.1rem;">Ø§Ù„Ù…Ø­Ø·Ø© 1</span>
                        <span class="context-note">Ø­ÙˆÙ„ Ù…Ø¸Ø§Ù‡Ø±Ø§Øª 11 Ø¯ÙŠØ³Ù…Ø¨Ø± 1960</span>
                    </div>
                    <p id="lvl-desc" style="font-size:0.9rem; color:#666; margin-top:5px;">Ø§Ù„ÙˆØµÙ</p>
                </div>
                
                <div id="slots-container"></div>
            </div>

            <div class="cards-deck">
                <div class="deck-title">ğŸ‘‡ Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù„Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ø³Ø§Ø±:</div>
                <div id="cards-container" class="cards-grid"></div>
            </div>
        </div>

    </div>

    <div id="win-screen" class="overlay">
        <div class="confetti">ğŸ‰</div>
        <div style="font-size:5rem;">ğŸ‡©ğŸ‡¿</div>
        <h1 style="color:var(--primary); font-size: 2.5rem;">Ù‡Ù†ÙŠØ¦Ø§Ù‹ Ù„Ùƒ ÙŠØ§ Ø¨Ø·Ù„!</h1>
        <h2 style="color:var(--secondary);">"ØªØ­ÙŠØ§ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø­Ø±Ø© Ù…Ø³ØªÙ‚Ù„Ø©"</h2>
        <p style="color:#777;">Ù„Ù‚Ø¯ Ø£ØªÙ…Ù…Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø·Ø§Øª Ø¨Ù†Ø¬Ø§Ø­.</p>
        <button class="btn-main" onclick="location.reload()">Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø© ğŸ”„</button>
    </div>

    <div id="lose-screen" class="overlay">
        <div style="font-size:5rem; filter: grayscale(1);">ğŸš‚</div>
        <h1 style="color:var(--secondary);">ØªÙˆÙ‚Ù Ø§Ù„Ù‚Ø·Ø§Ø±!</h1>
        <p>Ù„Ù‚Ø¯ Ù†ÙØ°Øª Ø¬Ù…ÙŠØ¹ Ù…Ø­Ø§ÙˆÙ„Ø§ØªÙƒ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø·Ø©.</p>
        <button class="btn-main" style="background:#555;" onclick="location.reload()">Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¨Ø¯Ø§ÙŠØ© â†©ï¸</button>
    </div>

    <script>
        const Levels = [
            {
                type: 'seq', title: "Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®", desc: "Ø±ØªØ¨ Ø£Ø­Ø¯Ø§Ø« Ù…Ø¸Ø§Ù‡Ø±Ø§Øª 11 Ø¯ÙŠØ³Ù…Ø¨Ø± Ø­Ø³Ø¨ ØªØ§Ø±ÙŠØ®Ù‡Ø§:",
                slots: ["04 Ù†ÙˆÙÙ…Ø¨Ø±", "09 Ø¯ÙŠØ³Ù…Ø¨Ø±", "10 Ø¯ÙŠØ³Ù…Ø¨Ø±", "11 Ø¯ÙŠØ³Ù…Ø¨Ø±", "20 Ø¯ÙŠØ³Ù…Ø¨Ø±"],
                ans: [1, 2, 3, 4, 5],
                items: [
                    {id:1, txt:"Ù…Ø´Ø±ÙˆØ¹ Ø¯ÙŠØºÙˆÙ„"}, {id:2, txt:"Ø§Ù†Ø·Ù„Ø§Ù‚ Ø§Ù„Ø´Ø±Ø§Ø±Ø© (Ø¹ÙŠÙ† ØªÙ…ÙˆØ´Ù†Øª)"},
                    {id:3, txt:"Ø§ØªØ³Ø§Ø¹ Ø§Ù„Ù…Ø¸Ø§Ù‡Ø±Ø§Øª (ÙˆÙ‡Ø±Ø§Ù†)"}, {id:4, txt:"Ø§Ù„Ø°Ø±ÙˆØ© (Ø§Ù„Ø¹Ø§ØµÙ…Ø©)"}, {id:5, txt:"Ø§Ù†ØªØµØ§Ø± Ø§Ù„Ø£Ù…Ù… Ø§Ù„Ù…ØªØ­Ø¯Ø©"}
                ]
            },
            {
                type: 'seq', title: "Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§", desc: "ØªØªØ¨Ø¹ Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø¸Ø§Ù‡Ø±Ø§Øª Ø¹Ø¨Ø± Ø§Ù„Ù…Ø¯Ù†:",
                slots: ["Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚", "Ø§Ù„ÙŠÙˆÙ… 1", "Ø§Ù„ØªØµØ¹ÙŠØ¯", "Ø§Ù„Ø°Ø±ÙˆØ©", "Ø§Ù„ØªØ¹Ù…ÙŠÙ…"],
                ans: [1, 2, 3, 4, 5],
                items: [
                    {id:1, txt:"Ø¹ÙŠÙ† ØªÙ…ÙˆØ´Ù†Øª"}, {id:2, txt:"ØªÙ„Ù…Ø³Ø§Ù†"}, {id:3, txt:"ÙˆÙ‡Ø±Ø§Ù†"},
                    {id:4, txt:"Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø§Ù„Ø¹Ø§ØµÙ…Ø©"}, {id:5, txt:"Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª"}
                ]
            },
            {
                type: 'quiz', title: "Ø§Ù„Ø±Ù…ÙˆØ²", desc: "Ø³Ø¤Ø§Ù„ Ø­ÙˆÙ„ Ø±Ù…ÙˆØ² Ù…Ø¸Ø§Ù‡Ø±Ø§Øª 11 Ø¯ÙŠØ³Ù…Ø¨Ø±:",
                q: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø°ÙŠ Ø±ÙØ¹Ù‡ Ø§Ù„Ù…ØªØ¸Ø§Ù‡Ø±ÙˆÙ† Ø¨ÙØ®Ø±ØŸ",
                ans: 'B',
                opts: [{id:'A', txt:"Ø§Ù„Ø´Ø¹Ø§Ø± Ø§Ù„ÙˆØ·Ù†ÙŠ"}, {id:'B', txt:"Ø§Ù„Ø¹Ù„Ù… Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ"}, {id:'C', txt:"ØµÙˆØ± Ø§Ù„Ù‚Ø§Ø¯Ø©"}]
            },
            {
                type: 'seq', title: "Ø§Ù„Ù†ØªØ§Ø¦Ø¬", desc: "Ø±ØªØ¨ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø¸Ø§Ù‡Ø±Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø³ÙŠØ© ÙˆØ§Ù„Ø¯Ø¨Ù„ÙˆÙ…Ø§Ø³ÙŠØ©:",
                slots: ["Ø³ÙŠØ§Ø³ÙŠØ§Ù‹", "Ø¹Ø³ÙƒØ±ÙŠØ§Ù‹", "Ø¯Ø¨Ù„ÙˆÙ…Ø§Ø³ÙŠØ§Ù‹", "Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Ù‹", "Ø§Ù„Ø®Ù„Ø§ØµØ©"],
                ans: [1, 2, 3, 4, 5],
                items: [
                    {id:1, txt:"Ø³Ù‚ÙˆØ· 'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± ÙØ±Ù†Ø³ÙŠØ©'"}, {id:2, txt:"ØªØ®ÙÙŠÙ Ø§Ù„Ø¶ØºØ· Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ"},
                    {id:3, txt:"Ø§Ø¹ØªØ±Ø§Ù Ø§Ù„Ø£Ù…Ù… Ø§Ù„Ù…ØªØ­Ø¯Ø©"}, {id:4, txt:"Ø¥Ø¬Ø¨Ø§Ø± Ø¯ÙŠØºÙˆÙ„ Ø¹Ø§Ù„ØªÙØ§ÙˆØ¶"}, {id:5, txt:"Ø­ØªÙ…ÙŠØ© Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„"}
                ]
            }
        ];

        const Game = {
            lvl: 0, step: 0, tries: 2,

            start() {
                document.getElementById('start-screen').classList.remove('active');
                const ui = document.getElementById('game-screen');
                ui.classList.add('active');
                ui.style.display = 'flex';
                this.load(0);
            },

            load(idx) {
                this.lvl = idx; this.step = 0; this.tries = 2;
                this.renderUI();
                this.updateTrainUI();
            },

            renderUI() {
                const data = Levels[this.lvl];
                document.getElementById('lvl-title').innerText = data.title;
                document.getElementById('lvl-desc').innerText = data.desc;
                document.getElementById('lives-count').innerText = this.tries;

                const slotsCont = document.getElementById('slots-container');
                const cardsCont = document.getElementById('cards-container');
                slotsCont.innerHTML = ''; cardsCont.innerHTML = '';

                if(data.type === 'seq') {
                    // Ø§Ù„Ø®Ø§Ù†Ø§Øª
                    data.slots.forEach((label, i) => {
                        slotsCont.innerHTML += `
                        <div class="slot ${i===0?'active':''}" id="s-${i}">
                            <div class="slot-label">${label}</div>
                            <div class="slot-content">ØŸ</div>
                        </div>`;
                    });
                    // Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
                    let arr = [...data.items].sort(()=>Math.random()-0.5);
                    arr.forEach(item => {
                        let div = document.createElement('div');
                        div.className = 'card'; div.innerText = item.txt;
                        div.onclick = () => this.check(item, div);
                        cardsCont.appendChild(div);
                    });
                    cardsCont.style.gridTemplateColumns = "1fr 1fr";
                } else {
                    // ÙƒÙˆÙŠØ²
                    slotsCont.innerHTML = `
                    <div class="slot active" style="padding:20px; flex-direction:column; height:auto; text-align:center;">
                        <h3 style="margin:0; color:var(--primary)">${data.q}</h3>
                    </div>`;
                    data.opts.forEach(opt => {
                        let div = document.createElement('div');
                        div.className = 'card'; div.innerText = opt.txt; div.style.fontSize="1rem";
                        div.onclick = () => this.checkQuiz(opt.id);
                        cardsCont.appendChild(div);
                    });
                    cardsCont.style.gridTemplateColumns = "1fr";
                }
            },

            check(item, el) {
                const correct = Levels[this.lvl].ans[this.step];
                if(item.id === correct) {
                    this.toast("Ø£Ø­Ø³Ù†Øª! Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© âœ…");
                    const slot = document.getElementById(`s-${this.step}`);
                    slot.querySelector('.slot-content').innerText = item.txt;
                    slot.classList.remove('active'); slot.classList.add('filled');
                    el.style.display = 'none'; // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
                    
                    this.step++;
                    if(this.step >= Levels[this.lvl].slots.length) {
                        setTimeout(() => this.nextLvl(), 800);
                    } else {
                        const nextSlot = document.getElementById(`s-${this.step}`);
                        nextSlot.classList.add('active');
                        nextSlot.scrollIntoView({behavior:'smooth', block:'center'});
                    }
                } else {
                    this.fail();
                }
            },

            checkQuiz(id) {
                if(id === Levels[this.lvl].ans) {
                    this.toast("Ø£Ø­Ø³Ù†Øª! Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© âœ…");
                    setTimeout(() => this.nextLvl(), 800);
                } else {
                    this.fail();
                }
            },

            fail() {
                this.tries--;
                document.getElementById('lives-count').innerText = this.tries;
                this.toast("Ø®Ø·Ø£! Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ âŒ");
                if(this.tries <= 0) {
                    setTimeout(() => {
                        document.getElementById('game-screen').classList.remove('active');
                        document.getElementById('lose-screen').classList.add('active');
                    }, 500);
                }
            },

            nextLvl() {
                if(this.lvl < 3) this.load(this.lvl + 1);
                else {
                    // Ø§Ù„ÙÙˆØ² Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
                    this.lvl = 4; // Ù„Ù…Ù„Ø¡ Ø§Ù„Ø´Ø±ÙŠØ· Ù„Ù„Ù†Ù‡Ø§ÙŠØ©
                    this.updateTrainUI();
                    setTimeout(() => {
                        document.getElementById('game-screen').classList.remove('active');
                        document.getElementById('win-screen').classList.add('active');
                    }, 1000);
                }
            },

            updateTrainUI() {
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©: 0%, 25%, 50%, 75%, 100%
                let pct = this.lvl * 25; // 4 Ù…Ø±Ø§Ø­Ù„
                if(this.lvl === 4) pct = 100; // Ø­Ø§Ù„Ø© Ø§Ù„ÙÙˆØ²

                document.getElementById('train-mover').style.right = pct + "%";
                document.getElementById('track-fill').style.width = pct + "%";

                for(let i=1; i<=4; i++) {
                    const st = document.getElementById(`st-${i}`);
                    if(i <= this.lvl) {
                        st.classList.remove('active');
                        st.classList.add('passed');
                        st.innerHTML = "âœ”"; // Ø¹Ù„Ø§Ù…Ø© ØµØ­
                    } else if(i === this.lvl + 1) {
                        st.classList.add('active');
                        st.innerHTML = i;
                    } else {
                        st.classList.remove('active', 'passed');
                        st.innerHTML = i;
                    }
                }
            },

            toast(msg) {
                const t = document.getElementById('toast');
                t.innerText = msg; t.style.display = 'block';
                setTimeout(() => t.style.display = 'none', 1000);
            }
        };
    </script>
</body>
</html>
