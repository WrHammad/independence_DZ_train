<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„Ø¹Ø¨Ø© Ù‚Ø·Ø§Ø± Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„: 11 Ø¯ÙŠØ³Ù…Ø¨Ø± 1960</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');

        :root {
            --dz-green: #006633;
            --dz-red: #D21034;
            --dz-white: #ffffff;
            --bg-color: #f4f6f9;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg-color);
            color: #333;
            text-align: center;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        /* --- Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© --- */
        .screen {
            display: none;
            padding: 20px;
            min-height: 100vh;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .active-screen {
            display: flex;
        }

        /* --- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© --- */
        #start-screen {
            background: linear-gradient(135deg, white 0%, #e8f5e9 100%);
        }

        .intro-box {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            max-width: 600px;
            border-top: 5px solid var(--dz-red);
            border-bottom: 5px solid var(--dz-green);
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ø³Ù… Ø§Ù„ÙƒØ§ØªØ¨ */
        .author-badge {
            display: inline-block;
            background-color: #f1f1f1;
            color: #333;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            margin: 10px 0 20px 0;
            border: 1px solid #ddd;
        }

        .rules-list {
            text-align: right;
            list-style: none;
            padding: 0;
            margin: 20px 0;
        }

        .rules-list li {
            margin-bottom: 10px;
            font-size: 1.1rem;
            position: relative;
            padding-right: 25px;
        }

        .rules-list li::before {
            content: 'âœ”';
            position: absolute;
            right: 0;
            color: var(--dz-green);
            font-weight: bold;
        }

        /* --- Ø´Ø±ÙŠØ· Ø§Ù„Ù‚Ø·Ø§Ø± (Ø§Ù„Ù…Ø³Ø§Ø± Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ù„Ù„ÙŠØ³Ø§Ø±) --- */
        .track-container {
            width: 90%;
            max-width: 800px;
            margin: 20px auto;
            position: relative;
            padding-top: 50px;
        }

        .track-line {
            height: 8px;
            background: #ccc;
            border-radius: 4px;
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-direction: row-reverse;
        }

        .station-dot {
            width: 35px;
            height: 35px;
            background: #bdc3c7;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            z-index: 2;
            border: 3px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .station-dot.active { background: var(--dz-green); transform: scale(1.1); }
        .station-dot.passed { background: var(--dz-green); opacity: 0.7; }

        /* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù‚Ø·Ø§Ø± */
        #train-icon {
            position: absolute;
            top: 0;
            right: 0;
            font-size: 3rem;
            transition: right 1.5s cubic-bezier(0.4, 0.0, 0.2, 1);
            z-index: 5;
            transform: translateX(50%);
        }

        /* --- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨ --- */
        .game-area {
            background: white;
            padding: 20px;
            border-radius: 15px;
            width: 95%;
            max-width: 900px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        h2 { color: var(--dz-green); margin-bottom: 5px; }
        .question-text { font-size: 1.1rem; color: #555; margin-bottom: 20px; font-weight: bold; }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª */
        .slots-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
        }

        .slot {
            width: 140px;
            min-height: 180px;
            border: 2px dashed #95a5a6;
            border-radius: 8px;
            background: #f8f9fa;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 5px;
            position: relative;
        }
        
        .slot-header {
            background: var(--dz-red);
            color: white;
            width: 100%;
            padding: 5px 0;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .slot.filled { border-style: solid; border-color: var(--dz-green); background: #e8f5e9; }

        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
        .cards-pool {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            min-height: 150px;
            padding: 10px;
            border-top: 1px solid #eee;
        }

        .card {
            width: 130px;
            height: 140px;
            background: white;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 8px;
            cursor: pointer;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            font-size: 0.8rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
            user-select: none;
            line-height: 1.3;
        }
        .card:hover { transform: translateY(-3px); border-color: var(--dz-green); }
        .card strong { color: var(--dz-red); display: block; margin-bottom: 5px; }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª (Ù„Ù„Ù…Ø±Ø­Ù„Ø© 3) */
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 500px;
            margin: 0 auto;
        }
        .quiz-btn {
            background: white;
            border: 2px solid #ccc;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            text-align: right;
            font-family: 'Cairo', sans-serif;
        }
        .quiz-btn:hover { border-color: var(--dz-green); background: #f0fff4; }
        .quiz-btn.selected { background: var(--dz-green); color: white; border-color: var(--dz-green); }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª */
        .attempts-bar {
            color: var(--dz-red);
            font-weight: bold;
            margin-bottom: 10px;
        }

        .main-btn {
            background-color: var(--dz-green);
            color: white;
            border: none;
            padding: 12px 40px;
            font-size: 1.1rem;
            border-radius: 30px;
            cursor: pointer;
            font-family: 'Cairo', sans-serif;
            margin-top: 20px;
        }
        .main-btn:disabled { background-color: #ccc; cursor: not-allowed; }

        .feedback-msg { margin-top: 10px; font-weight: bold; height: 30px; }
        .error { color: var(--dz-red); }
        .success { color: var(--dz-green); }

    </style>
</head>
<body>

    <div id="start-screen" class="screen active-screen">
        <div class="intro-box">
            <h1>ğŸš‚ Ù‚Ø·Ø§Ø± Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„</h1>
            <h3 style="color: #666; margin-bottom: 5px;">Ù…Ø¸Ø§Ù‡Ø±Ø§Øª 11 Ø¯ÙŠØ³Ù…Ø¨Ø± 1960</h3>
            
            <div class="author-badge">Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙƒØ§ØªØ¨ Ø­Ù…Ø§Ø¯ Ø¨Ù† Ø¹ÙŠØ³Ù‰</div>

            <p>Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ø¨Ø·Ù„ ÙÙŠ Ø±Ø­Ù„Ø© Ø¹Ø¨Ø± Ø§Ù„Ø²Ù…Ù† Ù„Ø¥Ø«Ø¨Ø§Øª Ø§Ø³ØªÙ‚Ù„Ø§Ù„ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±.</p>
            
            <ul class="rules-list">
                <li>Ø§Ù„Ù„Ø¹Ø¨Ø© ØªØªÙƒÙˆÙ† Ù…Ù† <strong>4 Ù…Ø­Ø·Ø§Øª</strong> Ø±Ø¦ÙŠØ³ÙŠØ©.</li>
                <li>ÙŠØ¬Ø¨ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø£Ùˆ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ù„ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ù‚Ø·Ø§Ø±.</li>
                <li>Ù„Ø¯ÙŠÙƒ <strong>Ù…Ø­Ø§ÙˆÙ„ØªØ§Ù† (2)</strong> ÙÙ‚Ø· ÙÙŠ ÙƒÙ„ Ù…Ø­Ø·Ø©.</li>
                <li>Ø¥Ø°Ø§ ÙØ´Ù„Øª ÙÙŠ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„ØªÙŠÙ†ØŒ Ø³ØªØ®Ø³Ø± Ø§Ù„Ù„Ø¹Ø¨Ø© ÙˆÙŠØ¹ÙˆØ¯ Ø§Ù„Ù‚Ø·Ø§Ø± Ù„Ù„Ø¨Ø¯Ø§ÙŠØ©.</li>
            </ul>

            <button class="main-btn" onclick="startGame()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø­Ù„Ø© ğŸš©</button>
        </div>
    </div>

    <div id="game-screen" class="screen">
        <header>
            <h2 style="margin:0; color:#333;">Ù‚Ø·Ø§Ø± Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„</h2>
        </header>

        <div class="track-container">
            <div id="train-icon">ğŸš‚</div>
            <div class="track-line">
                <div class="station-dot" id="st-4">4</div>
                <div class="station-dot" id="st-3">3</div>
                <div class="station-dot" id="st-2">2</div>
                <div class="station-dot active" id="st-1">1</div>
            </div>
        </div>

        <div class="game-area">
            <div class="attempts-bar" id="attempts-display">Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: 2</div>
            <h2 id="level-title">Ø§Ù„Ù…Ø­Ø·Ø© 1</h2>
            <p class="question-text" id="level-desc">Ø§Ù„ÙˆØµÙ...</p>

            <div id="level-content"></div>

            <div class="feedback-msg" id="feedback"></div>

            <button class="main-btn" id="action-btn" onclick="checkAnswer()">ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</button>
        </div>
    </div>

    <div id="game-over-screen" class="screen" style="background-color: #ffebee;">
        <h1 style="color: var(--dz-red);">âŒ ØªÙˆÙ‚Ù Ø§Ù„Ù‚Ø·Ø§Ø±!</h1>
        <p style="font-size: 1.2rem;">Ù„Ù‚Ø¯ Ø§Ø³ØªÙ†ÙØ¯Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø·Ø©.</p>
        <button class="main-btn" onclick="location.reload()" style="background-color: #c0392b;">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
    </div>

    <div id="victory-screen" class="screen" style="background-color: #e8f5e9;">
        <h1 style="color: var(--dz-green); font-size: 3rem;">ğŸ‰ ÙˆØµÙ„ Ø§Ù„Ù‚Ø·Ø§Ø±!</h1>
        <h2 style="color: var(--dz-red);">"ØªØ­ÙŠØ§ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø­Ø±Ø© Ù…Ø³ØªÙ‚Ù„Ø©"</h2>
        <div class="author-badge">Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙƒØ§ØªØ¨ Ø­Ù…Ø§Ø¯ Ø¨Ù† Ø¹ÙŠØ³Ù‰</div>
        <p style="font-size: 1.2rem;">Ù„Ù‚Ø¯ Ø£ØªÙ…Ù…Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø·Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ£Ø«Ø¨Øª Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„.</p>
        <button class="main-btn" onclick="location.reload()">Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
    </div>

    <script>
        const levels = [
            {
                type: 'drag',
                title: "Ø§Ù„Ù…Ø­Ø·Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø§Ù„ØªØ³Ù„Ø³Ù„ Ø§Ù„Ø²Ù…Ù†ÙŠ",
                desc: "Ø¶Ø¹ ÙƒÙ„ Ø­Ø¯Ø« ØªØ§Ø±ÙŠØ®ÙŠ ÙÙŠ ØªØ§Ø±ÙŠØ®Ù‡ Ø§Ù„ØµØ­ÙŠØ­:",
                slots: ["04 Ù†ÙˆÙÙ…Ø¨Ø± 1960", "09 Ø¯ÙŠØ³Ù…Ø¨Ø± 1960", "10 Ø¯ÙŠØ³Ù…Ø¨Ø± 1960", "11 Ø¯ÙŠØ³Ù…Ø¨Ø± 1960", "20 Ø¯ÙŠØ³Ù…Ø¨Ø± 1960"],
                items: [
                    { id: 1, text: "Ø®Ø·Ø§Ø¨ Ø¯ÙŠØºÙˆÙ„ ÙˆÙ…Ø´Ø±ÙˆØ¹ 'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø¬Ø²Ø§Ø¦Ø±ÙŠØ©'" },
                    { id: 2, text: "Ø§Ù†Ø·Ù„Ø§Ù‚ Ø§Ù„Ø´Ø±Ø§Ø±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù…Ù† Ø¹ÙŠÙ† ØªÙ…ÙˆØ´Ù†Øª" },
                    { id: 3, text: "Ø§ØªØ³Ø§Ø¹ Ø§Ù„Ù…Ø¸Ø§Ù‡Ø±Ø§Øª Ù„ØªØ´Ù…Ù„ ÙˆÙ‡Ø±Ø§Ù†" },
                    { id: 4, text: "ÙŠÙˆÙ… Ø§Ù„Ø°Ø±ÙˆØ© ÙˆØ®Ø±ÙˆØ¬ Ø§Ù„Ø¬Ù…Ø§Ù‡ÙŠØ± Ø§Ù„Ø¹Ø§Ø±Ù…Ø© ÙÙŠ Ø§Ù„Ø¹Ø§ØµÙ…Ø©" },
                    { id: 5, text: "Ø§Ù†ØªØµØ§Ø± Ø¯Ø¨Ù„ÙˆÙ…Ø§Ø³ÙŠ ÙÙŠ Ø§Ù„Ø£Ù…Ù… Ø§Ù„Ù…ØªØ­Ø¯Ø©" }
                ]
            },
            {
                type: 'drag',
                title: "Ø§Ù„Ù…Ø­Ø·Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ",
                desc: "Ø±ØªØ¨ Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ù„Ù…Ø¸Ø§Ù‡Ø±Ø§Øª Ø¨ÙŠÙ† Ø§Ù„Ù…Ø¯Ù† Ø­Ø³Ø¨ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ:",
                slots: ["1. Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚", "2. Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø£ÙˆÙ„", "3. Ø§Ù„ØªØµØ¹ÙŠØ¯", "4. Ø§Ù„Ø°Ø±ÙˆØ©", "5. Ø§Ù„ØªØ¹Ù…ÙŠÙ…"],
                items: [
                    { id: 1, text: "Ø¹ÙŠÙ† ØªÙ…ÙˆØ´Ù†Øª (ÙŠÙˆÙ… ÙˆØµÙˆÙ„ Ø¯ÙŠØºÙˆÙ„)" },
                    { id: 2, text: "ØªÙ„Ù…Ø³Ø§Ù† (Ø±ÙØ¹ Ø§Ù„Ø¹Ù„Ù… Ø±ØºÙ… Ø§Ù„Ø¨Ø±Ø¯)" },
                    { id: 3, text: "ÙˆÙ‡Ø±Ø§Ù† (Ù„ÙŠÙ„Ø© Ù…Ø±Ø¹Ø¨Ø© ÙˆØµØ¯Ø§Ù…Ø§Øª)" },
                    { id: 4, text: "Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø§Ù„Ø¹Ø§ØµÙ…Ø© (Ø¨Ù„ÙƒÙˆØ± ÙˆØ§Ù„Ù‚ØµØ¨Ø©)" },
                    { id: 5, text: "Ù‚Ø³Ù†Ø·ÙŠÙ†Ø© ÙˆØ¹Ù†Ø§Ø¨Ø© ÙˆØ¨Ø¬Ø§ÙŠØ© (Ø§Ù„ØºÙ„ÙŠØ§Ù† Ø§Ù„Ø´Ø¹Ø¨ÙŠ)" }
                ]
            },
            {
                type: 'quiz',
                title: "Ø§Ù„Ù…Ø­Ø·Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©: Ø§Ù„Ø±Ù…ÙˆØ²",
                desc: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø°ÙŠ ÙƒØ§Ù† Ø§Ù„Ù…ØªØ¸Ø§Ù‡Ø±ÙˆÙ† ÙŠØ±ÙØ¹ÙˆÙ†Ù‡ Ø¨ÙØ®Ø± Ø®Ù„Ø§Ù„ Ù…Ø¸Ø§Ù‡Ø±Ø§Øª 11 Ø¯ÙŠØ³Ù…Ø¨Ø± 1960ØŸ",
                options: [
                    { id: 'A', text: "A. Ø§Ù„Ø´Ø¹Ø§Ø± Ø§Ù„ÙˆØ·Ù†ÙŠ" },
                    { id: 'B', text: "B. Ø§Ù„Ø¹Ù„Ù… Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ" }, 
                    { id: 'C', text: "C. ØµÙˆØ± Ù‚Ø§Ø¯Ø© Ø§Ù„Ø«ÙˆØ±Ø©" }
                ],
                correctAnswer: 'B'
            },
            {
                type: 'drag',
                title: "Ø§Ù„Ù…Ø­Ø·Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©: Ø§Ù„Ù†ØªØ§Ø¦Ø¬",
                desc: "Ø±ØªØ¨ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø¸Ø§Ù‡Ø±Ø§Øª ÙˆØªØ£Ø«ÙŠØ±Ù‡Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø«ÙˆØ±Ø©:",
                slots: ["1. Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø³ÙŠØ§Ø³ÙŠØ©", "2. Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠØ©", "3. Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¯Ø¨Ù„ÙˆÙ…Ø§Ø³ÙŠØ©", "4. Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©", "5. Ø§Ù„Ø®Ù„Ø§ØµØ©"],
                items: [
                    { id: 1, text: "Ø¥ÙØ´Ø§Ù„ Ø®Ø·Ø© Ø¯ÙŠØºÙˆÙ„ ÙˆØ³Ù‚ÙˆØ· Ø®Ø±Ø§ÙØ© 'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± ÙØ±Ù†Ø³ÙŠØ©'" },
                    { id: 2, text: "ØªØ®ÙÙŠÙ Ø§Ù„Ø¶ØºØ· Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø¨Ø§Ù„" },
                    { id: 3, text: "Ø§Ø¹ØªØ±Ø§Ù Ø§Ù„Ø£Ù…Ù… Ø§Ù„Ù…ØªØ­Ø¯Ø© Ø¨Ø­Ù‚ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ØµÙŠØ±" },
                    { id: 4, text: "Ø¥Ø¬Ø¨Ø§Ø± Ø¯ÙŠØºÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙØ§ÙˆØ¶ Ù…Ø¹ Ø§Ù„Ø¬Ø¨Ù‡Ø©" },
                    { id: 5, text: "Ø§Ù„ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„ Ø¢ØªÙ Ù„Ø§ Ù…Ø­Ø§Ù„Ø©" }
                ]
            }
        ];

        let currentLevel = 0;
        let attempts = 2;
        let currentDragState = [null, null, null, null, null];
        let selectedQuizOption = null;

        function startGame() {
            document.getElementById('start-screen').classList.remove('active-screen');
            document.getElementById('game-screen').classList.add('active-screen');
            loadLevel(0);
        }

        function loadLevel(levelIndex) {
            currentLevel = levelIndex;
            const levelData = levels[levelIndex];
            attempts = 2;
            
            document.getElementById('level-title').innerText = levelData.title;
            document.getElementById('level-desc').innerText = levelData.desc;
            document.getElementById('attempts-display').innerText = `Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: ${attempts}`;
            document.getElementById('feedback').innerText = "";
            document.getElementById('feedback').className = "feedback-msg";
            
            const btn = document.getElementById('action-btn');
            btn.innerText = "ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©";
            btn.onclick = checkAnswer;
            btn.style.display = 'inline-block';

            const contentDiv = document.getElementById('level-content');
            contentDiv.innerHTML = "";

            if (levelData.type === 'drag') {
                currentDragState = [null, null, null, null, null];
                setupDragLevel(contentDiv, levelData);
            } else if (levelData.type === 'quiz') {
                selectedQuizOption = null;
                setupQuizLevel(contentDiv, levelData);
            }

            updateTrainProgress();
        }

        function setupDragLevel(container, data) {
            const slotsDiv = document.createElement('div');
            slotsDiv.className = 'slots-container';
            
            data.slots.forEach((label, idx) => {
                const slot = document.createElement('div');
                slot.className = 'slot';
                slot.id = `slot-${idx}`;
                
                const header = document.createElement('div');
                header.className = 'slot-header';
                header.innerText = label;
                
                slot.appendChild(header);
                slot.onclick = () => returnCard(idx);
                slotsDiv.appendChild(slot);
            });
            container.appendChild(slotsDiv);

            const poolDiv = document.createElement('div');
            poolDiv.className = 'cards-pool';
            poolDiv.id = 'pool';
            
            let shuffled = [...data.items].sort(() => Math.random() - 0.5);
            
            shuffled.forEach(item => {
                const card = document.createElement('div');
                card.className = 'card';
                card.id = `card-${item.id}`;
                card.innerHTML = `<p>${item.text}</p>`;
                card.onclick = () => selectCard(item, card);
                poolDiv.appendChild(card);
            });
            container.appendChild(poolDiv);
        }

        function setupQuizLevel(container, data) {
            const optionsDiv = document.createElement('div');
            optionsDiv.className = 'quiz-options';

            data.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'quiz-btn';
                btn.innerText = opt.text;
                btn.onclick = () => {
                    document.querySelectorAll('.quiz-btn').forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    selectedQuizOption = opt.id;
                };
                optionsDiv.appendChild(btn);
            });
            container.appendChild(optionsDiv);
        }

        function selectCard(item, cardElem) {
            const emptyIdx = currentDragState.indexOf(null);
            if (emptyIdx !== -1) {
                const slot = document.getElementById(`slot-${emptyIdx}`);
                slot.appendChild(cardElem);
                slot.classList.add('filled');
                currentDragState[emptyIdx] = item.id;
            }
        }

        function returnCard(idx) {
            if (currentDragState[idx] !== null) {
                const slot = document.getElementById(`slot-${idx}`);
                const card = slot.querySelector('.card');
                if (card) {
                    document.getElementById('pool').appendChild(card);
                    slot.classList.remove('filled');
                    currentDragState[idx] = null;
                }
            }
        }

        function updateTrainProgress() {
            const step = 90 / 3; 
            const position = currentLevel * step;
            
            document.getElementById('train-icon').style.right = `${position}%`;

            for(let i=1; i<=4; i++) {
                const dot = document.getElementById(`st-${i}`);
                if (i <= currentLevel + 1) {
                    dot.classList.add('passed');
                }
                if (i === currentLevel + 1) {
                    dot.classList.add('active');
                    dot.classList.remove('passed');
                }
            }
        }

        function checkAnswer() {
            const levelData = levels[currentLevel];
            let isCorrect = false;

            if (levelData.type === 'drag') {
                if (currentDragState.includes(null)) {
                    showMessage("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø§Ù†Ø§Øª!", "error");
                    return;
                }
                const correctSeq = [1, 2, 3, 4, 5];
                isCorrect = JSON.stringify(currentDragState) === JSON.stringify(correctSeq);
            
            } else if (levelData.type === 'quiz') {
                if (!selectedQuizOption) {
                    showMessage("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø¥Ø¬Ø§Ø¨Ø©!", "error");
                    return;
                }
                isCorrect = (selectedQuizOption === levelData.correctAnswer);
            }

            if (isCorrect) {
                showMessage("Ø£Ø­Ø³Ù†Øª! Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© âœ…", "success");
                document.getElementById('action-btn').innerText = "Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù…Ø­Ø·Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© â¬…";
                document.getElementById('action-btn').onclick = nextLevel;
                if(document.getElementById('pool')) document.getElementById('pool').style.pointerEvents = 'none';
                if(document.querySelector('.quiz-options')) document.querySelector('.quiz-options').style.pointerEvents = 'none';

            } else {
                attempts--;
                document.getElementById('attempts-display').innerText = `Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: ${attempts}`;
                
                if (attempts > 0) {
                    showMessage("Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©! Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ âŒ", "error");
                    if (levelData.type === 'drag') {
                        setTimeout(() => {
                            resetDragCards();
                        }, 1000);
                    }
                } else {
                    document.getElementById('game-screen').classList.remove('active-screen');
                    document.getElementById('game-over-screen').classList.add('active-screen');
                }
            }
        }

        function resetDragCards() {
            for(let i=0; i<5; i++) {
                returnCard(i);
            }
            showMessage("ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª.. Ø±ÙƒØ² Ø¬ÙŠØ¯Ø§Ù‹!", "error");
        }

        function showMessage(text, type) {
            const el = document.getElementById('feedback');
            el.innerText = text;
            el.className = "feedback-msg " + type;
        }

        function nextLevel() {
            if (currentLevel < 3) {
                loadLevel(currentLevel + 1);
            } else {
                document.getElementById('train-icon').style.right = "95%"; 
                setTimeout(() => {
                    document.getElementById('game-screen').classList.remove('active-screen');
                    document.getElementById('victory-screen').classList.add('active-screen');
                }, 1000);
            }
        }
    </script>
</body>
</html>