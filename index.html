<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù‚Ø·Ø§Ø± Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap');

        :root {
            --primary: #006633;
            --secondary: #D21034;
            --bg: #f4f4f9;
            --white: #ffffff;
            --text: #333;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            height: 100vh;
            height: 100dvh; /* Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹ Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
            display: flex;
            flex-direction: column;
            overflow: hidden; /* ÙŠÙ…Ù†Ø¹ Ø­Ø±ÙƒØ© Ø§Ù„ØµÙØ­Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
        }

        /* 1. Ø§Ù„Ø±Ø£Ø³ (Ù…Ø¶ØºÙˆØ· Ø¬Ø¯Ø§Ù‹) */
        header {
            background: var(--white);
            padding: 5px 15px;
            border-bottom: 2px solid var(--secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            height: 50px;
            z-index: 10;
        }
        h1 { margin: 0; font-size: 1rem; color: var(--text); }
        
        /* ØªØµÙ…ÙŠÙ… Ù…ØµØºØ± Ù„Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª */
        .attempts-mini { 
            font-size: 0.75rem; 
            color: #555; 
            background: #eee; 
            padding: 2px 8px; 
            border-radius: 12px; 
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .attempts-count { color: var(--secondary); font-size: 0.9rem; }

        /* 2. Ø´Ø±ÙŠØ· Ø§Ù„Ù‚Ø·Ø§Ø± (Ø«Ø§Ø¨Øª) */
        .train-area {
            background: #e9ecef;
            padding: 10px 0;
            flex-shrink: 0;
            position: relative;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .track {
            width: 85%; margin: 0 auto; height: 4px; background: #bbb;
            display: flex; justify-content: space-between; align-items: center;
            flex-direction: row-reverse; position: relative; border-radius: 5px;
        }
        
        .dot {
            width: 20px; height: 20px; background: #999; border-radius: 50%;
            display: grid; place-items: center; color: white; font-size: 0.7rem;
            z-index: 2; border: 2px solid #e9ecef; transition: 0.3s;
        }
        .dot.active { background: var(--primary); transform: scale(1.3); }
        .dot.passed { background: var(--primary); opacity: 0.6; }

        #train {
            position: absolute; top: -12px; right: 0; font-size: 1.6rem;
            transform: translateX(50%); transition: right 1s; z-index: 5;
        }

        /* 3. Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© (ØªØªÙƒÙŠÙ Ù…Ø¹ Ø§Ù„Ø´Ø§Ø´Ø©) */
        .game-wrapper {
            flex-grow: 1; /* ÙŠØ£Ø®Ø° ÙƒÙ„ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© */
            display: flex;
            flex-direction: column;
            overflow: hidden; /* ÙŠØ­ØµØ± Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¯Ø§Ø®Ù„ÙŠØ§Ù‹ */
            position: relative;
        }

        /* 3-Ø£. Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ (Ù‡Ù†Ø§ ÙŠØ­Ø¯Ø« Ø§Ù„ØªÙ…Ø±ÙŠØ±) */
        .timeline-scroll-area {
            flex-grow: 1;
            overflow-y: auto; /* Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠ Ù…Ø³Ù…ÙˆØ­ Ù‡Ù†Ø§ ÙÙ‚Ø· */
            padding: 10px;
            padding-bottom: 20px;
            background: var(--bg);
        }

        .level-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 8px; background: white; padding: 8px 12px; border-radius: 8px;
            position: sticky; top: 0; z-index: 5; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø®Ø§Ù†Ø§Øª */
        .slot {
            display: flex; background: white; border: 1px solid #ccc;
            border-radius: 8px; min-height: 55px; opacity: 0.6; filter: grayscale(1);
            transition: 0.3s; margin-bottom: 8px;
        }
        .slot.active {
            opacity: 1; filter: grayscale(0); border: 2px solid var(--primary);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); transform: scale(1.01);
            background: #fff;
        }
        .slot.filled { opacity: 1; filter: grayscale(0); background: #e8f5e9; border-color: var(--primary); }

        .slot-time {
            width: 75px; background: #f8f9fa; border-left: 1px solid #ddd;
            display: grid; place-items: center; font-size: 0.7rem; font-weight: bold; color: var(--secondary);
            text-align: center; padding: 5px;
        }
        .slot-ans { flex-grow: 1; display: grid; place-items: center; padding: 5px; font-size: 0.8rem; text-align: center; line-height: 1.2; }

        /* 3-Ø¨. Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª (Ø«Ø§Ø¨ØªØ© ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„) */
        .cards-fixed-bottom {
            background: white;
            border-top: 2px solid var(--primary);
            padding: 8px;
            flex-shrink: 0; /* Ù…Ù…Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ù„Øµ */
            z-index: 20;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.1);
        }

        .dock-title { font-size: 0.75rem; color: #666; margin-bottom: 5px; text-align: center; }

        .cards-grid {
            display: grid; 
            grid-template-columns: repeat(2, 1fr); /* Ø¨Ø·Ø§Ù‚ØªØ§Ù† ÙÙŠ Ø§Ù„ØµÙ */
            gap: 6px;
        }

        .card {
            background: #f4f4f4; border: 1px solid #ddd; padding: 8px;
            border-radius: 6px; text-align: center; font-size: 0.75rem;
            min-height: 45px; display: flex; align-items: center; justify-content: center;
            cursor: pointer; user-select: none; transition: 0.1s;
        }
        .card:active { background: #dcedc8; transform: scale(0.96); border-color: var(--primary); }

        /* ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù„Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± */
        @media (min-width: 768px) {
            .game-wrapper { flex-direction: row; }
            .timeline-scroll-area { width: 65%; border-left: 1px solid #ddd; }
            .cards-fixed-bottom { width: 35%; border-top: none; border-right: 2px solid var(--primary); }
            .cards-grid { grid-template-columns: 1fr; }
            .card { padding: 15px; font-size: 0.9rem; margin-bottom: 5px; }
        }

        /* Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
        .overlay {
            position: fixed; inset: 0; background: white; z-index: 100;
            display: none; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; padding: 20px;
        }
        .overlay.active { display: flex; }
        
        .btn {
            background: var(--primary); color: white; border: none; padding: 10px 30px;
            border-radius: 25px; font-size: 1rem; margin-top: 20px; cursor: pointer;
            box-shadow: 0 4px 0 #004d26;
        }
        .btn:active { transform: translateY(4px); box-shadow: none; }

        .toast {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.85); color: white; padding: 10px 20px;
            border-radius: 20px; display: none; z-index: 200; font-size: 0.9rem;
        }

    </style>
</head>
<body>

    <div id="toast" class="toast"></div>

    <div id="start-screen" class="overlay active">
        <h1 style="color:var(--primary); font-size:1.8rem;">ğŸš‚ Ù‚Ø·Ø§Ø± Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„</h1>
        <p style="color:#555; margin: 20px 0;">Ø±ØªØ¨ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ© Ù„Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ù‚Ø·Ø§Ø±.<br>Ù„Ø¯ÙŠÙƒ Ù…Ø­Ø§ÙˆÙ„ØªØ§Ù† Ù„ÙƒÙ„ Ù…Ø­Ø·Ø©.</p>
        <button class="btn" onclick="Game.start()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨</button>
    </div>

    <div id="game-screen" class="overlay" style="background: var(--bg); display: none; justify-content: flex-start; padding: 0;">
        
        <header>
            <h1>Ù‚Ø·Ø§Ø± Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„</h1>
            <div class="attempts-mini">
                <span>Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª:</span>
                <span class="attempts-count" id="attempts-ui">2</span>
            </div>
        </header>

        <div class="train-area">
            <div class="track">
                <div class="dot" id="d4">4</div>
                <div class="dot" id="d3">3</div>
                <div class="dot" id="d2">2</div>
                <div class="dot active" id="d1">1</div>
                <div id="train">ğŸš‚</div>
            </div>
        </div>

        <div class="game-wrapper">
            <div class="timeline-scroll-area">
                <div class="level-header">
                    <span id="lvl-title" style="color:var(--primary); font-weight:bold; font-size: 0.9rem;">Ø§Ù„Ù…Ø­Ø·Ø© 1</span>
                    <span id="lvl-desc" style="font-size:0.75rem; color:#666;">Ø§Ù„ÙˆØµÙ</span>
                </div>
                <div id="slots-container"></div>
            </div>

            <div class="cards-fixed-bottom">
                <div class="dock-title" id="dock-hint">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©:</div>
                <div id="cards-container" class="cards-grid"></div>
            </div>
        </div>

    </div>

    <div id="win-screen" class="overlay">
        <h1 style="font-size:4rem;">ğŸ‡©ğŸ‡¿</h1>
        <h1 style="color:var(--primary);">Ù…Ø¨Ø±ÙˆÙƒ!</h1>
        <h2>"ØªØ­ÙŠØ§ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø­Ø±Ø© Ù…Ø³ØªÙ‚Ù„Ø©"</h2>
        <button class="btn" onclick="location.reload()">Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
    </div>

    <div id="lose-screen" class="overlay">
        <h1 style="font-size:4rem;">â›”</h1>
        <h1>ØªÙˆÙ‚Ù Ø§Ù„Ù‚Ø·Ø§Ø±</h1>
        <button class="btn" style="background:var(--secondary);" onclick="location.reload()">Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹</button>
    </div>

    <script>
        const Levels = [
            {
                type: 'seq', title: "1. Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®", desc: "Ø·Ø§Ø¨Ù‚ Ø§Ù„Ø­Ø¯Ø« Ù…Ø¹ ØªØ§Ø±ÙŠØ®Ù‡",
                slots: ["04 Ù†ÙˆÙÙ…Ø¨Ø±", "09 Ø¯ÙŠØ³Ù…Ø¨Ø±", "10 Ø¯ÙŠØ³Ù…Ø¨Ø±", "11 Ø¯ÙŠØ³Ù…Ø¨Ø±", "20 Ø¯ÙŠØ³Ù…Ø¨Ø±"],
                ans: [1, 2, 3, 4, 5],
                items: [
                    {id:1, txt:"Ù…Ø´Ø±ÙˆØ¹ Ø¯ÙŠØºÙˆÙ„"}, {id:2, txt:"Ø§Ù†Ø·Ù„Ø§Ù‚ Ø§Ù„Ø´Ø±Ø§Ø±Ø© (Ø¹ÙŠÙ† ØªÙ…ÙˆØ´Ù†Øª)"},
                    {id:3, txt:"Ø§ØªØ³Ø§Ø¹ Ø§Ù„Ù…Ø¸Ø§Ù‡Ø±Ø§Øª (ÙˆÙ‡Ø±Ø§Ù†)"}, {id:4, txt:"Ø§Ù„Ø°Ø±ÙˆØ© (Ø§Ù„Ø¹Ø§ØµÙ…Ø©)"}, {id:5, txt:"Ø§Ù†ØªØµØ§Ø± Ø§Ù„Ø£Ù…Ù… Ø§Ù„Ù…ØªØ­Ø¯Ø©"}
                ]
            },
            {
                type: 'seq', title: "2. Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§", desc: "Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø¸Ø§Ù‡Ø±Ø§Øª",
                slots: ["Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚", "Ø§Ù„ÙŠÙˆÙ… 1", "Ø§Ù„ØªØµØ¹ÙŠØ¯", "Ø§Ù„Ø°Ø±ÙˆØ©", "Ø§Ù„ØªØ¹Ù…ÙŠÙ…"],
                ans: [1, 2, 3, 4, 5],
                items: [
                    {id:1, txt:"Ø¹ÙŠÙ† ØªÙ…ÙˆØ´Ù†Øª"}, {id:2, txt:"ØªÙ„Ù…Ø³Ø§Ù†"}, {id:3, txt:"ÙˆÙ‡Ø±Ø§Ù†"},
                    {id:4, txt:"Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø§Ù„Ø¹Ø§ØµÙ…Ø©"}, {id:5, txt:"Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª"}
                ]
            },
            {
                type: 'quiz', title: "3. Ø§Ù„Ø±Ù…ÙˆØ²", desc: "Ø³Ø¤Ø§Ù„ Ø¹Ù† Ø§Ù„Ø±Ù…ÙˆØ²",
                q: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø°ÙŠ Ø±ÙØ¹Ù‡ Ø§Ù„Ù…ØªØ¸Ø§Ù‡Ø±ÙˆÙ†ØŸ",
                ans: 'B',
                opts: [{id:'A', txt:"Ø§Ù„Ø´Ø¹Ø§Ø± Ø§Ù„ÙˆØ·Ù†ÙŠ"}, {id:'B', txt:"Ø§Ù„Ø¹Ù„Ù… Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ"}, {id:'C', txt:"ØµÙˆØ± Ø§Ù„Ù‚Ø§Ø¯Ø©"}]
            },
            {
                type: 'seq', title: "4. Ø§Ù„Ù†ØªØ§Ø¦Ø¬", desc: "Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø­Ù‚Ù‚Ø©",
                slots: ["Ø³ÙŠØ§Ø³ÙŠØ§Ù‹", "Ø¹Ø³ÙƒØ±ÙŠØ§Ù‹", "Ø¯Ø¨Ù„ÙˆÙ…Ø§Ø³ÙŠØ§Ù‹", "Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Ù‹", "Ø§Ù„Ø®Ù„Ø§ØµØ©"],
                ans: [1, 2, 3, 4, 5],
                items: [
                    {id:1, txt:"Ø³Ù‚ÙˆØ· 'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± ÙØ±Ù†Ø³ÙŠØ©'"}, {id:2, txt:"ØªØ®ÙÙŠÙ Ø§Ù„Ø¶ØºØ· Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ"},
                    {id:3, txt:"Ø§Ø¹ØªØ±Ø§Ù Ø§Ù„Ø£Ù…Ù… Ø§Ù„Ù…ØªØ­Ø¯Ø©"}, {id:4, txt:"Ø¥Ø¬Ø¨Ø§Ø± Ø¯ÙŠØºÙˆÙ„ Ø¹Ø§Ù„ØªÙØ§ÙˆØ¶"}, {id:5, txt:"Ø­ØªÙ…ÙŠØ© Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„"}
                ]
            }
        ];

        const Game = {
            lvl: 0, step: 0, tries: 2,

            start() {
                document.getElementById('start-screen').classList.remove('active');
                const gameUI = document.getElementById('game-screen');
                gameUI.classList.add('active');
                gameUI.style.display = 'flex'; 
                this.load(0);
            },

            load(idx) {
                this.lvl = idx; this.step = 0; this.tries = 2;
                this.renderUI();
                this.moveTrain();
            },

            renderUI() {
                const data = Levels[this.lvl];
                document.getElementById('lvl-title').innerText = data.title;
                document.getElementById('lvl-desc').innerText = data.desc;
                document.getElementById('attempts-ui').innerText = this.tries;

                const tLine = document.getElementById('slots-container');
                const dock = document.getElementById('cards-container');
                tLine.innerHTML = ''; dock.innerHTML = '';

                if(data.type === 'seq') {
                    // Ø§Ù„Ø®Ø§Ù†Ø§Øª
                    data.slots.forEach((s, i) => {
                        tLine.innerHTML += `
                        <div class="slot ${i===0?'active':''}" id="s-${i}">
                            <div class="slot-time">${s}</div>
                            <div class="slot-ans">ØŸ</div>
                        </div>`;
                    });
                    // Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
                    let arr = [...data.items].sort(()=>Math.random()-0.5);
                    arr.forEach(item => {
                        let div = document.createElement('div');
                        div.className = 'card'; div.innerText = item.txt;
                        div.onclick = () => this.checkSeq(item, div);
                        dock.appendChild(div);
                    });
                    document.getElementById('cards-container').style.gridTemplateColumns = "1fr 1fr";
                } else {
                    // Ø§Ù„ÙƒÙˆÙŠØ²
                    tLine.innerHTML = `<div class="slot active" style="padding:15px; flex-direction:column; height:auto;">
                        <h3 style="margin:0; color:var(--primary); font-size:1rem;">${data.q}</h3>
                    </div>`;
                    data.opts.forEach(o => {
                        let div = document.createElement('div');
                        div.className = 'card'; div.innerText = o.txt; div.style.fontSize="1rem";
                        div.onclick = () => this.checkQuiz(o.id);
                        dock.appendChild(div);
                    });
                    document.getElementById('cards-container').style.gridTemplateColumns = "1fr";
                }
            },

            checkSeq(item, el) {
                const correct = Levels[this.lvl].ans[this.step];
                if(item.id === correct) {
                    this.toast("ØµØ­ÙŠØ­ âœ…");
                    const slot = document.getElementById(`s-${this.step}`);
                    slot.querySelector('.slot-ans').innerText = item.txt;
                    slot.classList.remove('active'); slot.classList.add('filled');
                    el.style.display = 'none'; // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©
                    
                    this.step++;
                    if(this.step >= Levels[this.lvl].slots.length) {
                        setTimeout(()=>this.next(), 800);
                    } else {
                        const next = document.getElementById(`s-${this.step}`);
                        next.classList.add('active');
                        next.scrollIntoView({behavior:'smooth', block:'center'});
                    }
                } else {
                    this.fail();
                }
            },

            checkQuiz(id) {
                if(id === Levels[this.lvl].ans) {
                    this.toast("ØµØ­ÙŠØ­ âœ…");
                    setTimeout(()=>this.next(), 800);
                } else {
                    this.fail();
                }
            },

            fail() {
                this.tries--;
                document.getElementById('attempts-ui').innerText = this.tries;
                this.toast("Ø®Ø·Ø£ âŒ");
                if(this.tries <= 0) {
                    setTimeout(()=>{
                        document.getElementById('game-screen').classList.remove('active');
                        document.getElementById('lose-screen').classList.add('active');
                    }, 500);
                }
            },

            next() {
                if(this.lvl < 3) this.load(this.lvl+1);
                else {
                    document.getElementById('train').style.right = "92%";
                    setTimeout(()=>{
                        document.getElementById('game-screen').classList.remove('active');
                        document.getElementById('win-screen').classList.add('active');
                    }, 1000);
                }
            },

            moveTrain() {
                let p = this.lvl * 30;
                document.getElementById('train').style.right = p + "%";
                for(let i=1; i<=4; i++) {
                    let d = document.getElementById(`d${i}`);
                    if(i <= this.lvl+1) d.classList.add('passed');
                    if(i === this.lvl+1) { d.classList.remove('passed'); d.classList.add('active'); }
                    else d.classList.remove('active');
                }
            },

            toast(msg) {
                let t = document.getElementById('toast');
                t.innerText = msg; t.style.display = 'block';
                setTimeout(()=>t.style.display='none', 800);
            }
        };
    </script>
</body>
</html>
