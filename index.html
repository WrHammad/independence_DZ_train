<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Ù‚Ø·Ø§Ø± Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„ | Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@500;700;900&display=swap');

        :root {
            --primary: #006633;
            --primary-dark: #004d26;
            --secondary: #D21034;
            --accent: #f59e0b;
            --bg-body: #f8fafc;
            --surface: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --header-h: 60px;
            --train-h: 120px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0; padding: 0;
            height: 100vh; height: 100dvh;
            display: flex; flex-direction: column;
            overflow: hidden;
        }

        /* --- Ø§Ù„Ø±Ø£Ø³ --- */
        header {
            height: var(--header-h);
            background: var(--surface);
            padding: 0 20px;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 2px solid #e2e8f0;
            flex-shrink: 0; z-index: 20;
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }
        
        .header-title { font-size: 1rem; color: var(--primary); font-weight: 900; display:flex; flex-direction:column; line-height:1.1;}
        .header-title small { font-size: 0.75rem; color: var(--text-muted); font-weight: 600; }
        
        .lives-badge {
            background: #fff1f2; color: var(--secondary);
            padding: 4px 12px; border-radius: 20px;
            font-weight: 800; font-size: 0.9rem;
            display: flex; align-items: center; gap: 6px;
            border: 1px solid #fecdd3;
            box-shadow: 0 2px 4px rgba(210, 16, 52, 0.1);
        }

        /* --- Ø´Ø±ÙŠØ· Ø§Ù„Ù‚Ø·Ø§Ø± (Ù…Ø­Ø¯Ø« Ù„Ù€ 8 Ù…Ø­Ø·Ø§Øª) --- */
        .train-container {
            height: var(--train-h);
            background: linear-gradient(180deg, #e0f2fe 0%, #f0f9ff 100%);
            position: relative;
            flex-shrink: 0;
            display: flex; align-items: center; justify-content: flex-start; /* Ù…Ø­Ø§Ø°Ø§Ø© Ù„Ù„ÙŠØ³Ø§Ø± Ù„Ù„ØªÙ…Ø±ÙŠØ± */
            border-bottom: 1px solid #bfdbfe;
            overflow-x: auto;
            padding: 0 20px 15px;
            scroll-behavior: smooth;
        }

        /* Ø¥Ø®ÙØ§Ø¡ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        .train-container::-webkit-scrollbar { display: none; }

        .rail-track {
            position: relative; 
            min-width: 600px; /* Ø¹Ø±Ø¶ ÙƒØ§ÙÙ Ù„Ù€ 8 Ù…Ø­Ø·Ø§Øª */
            height: 12px;
            background: #cbd5e1; border-radius: 6px;
            display: flex; align-items: center; justify-content: space-between;
            flex-direction: row-reverse;
            padding: 0 10px;
            margin: 0 auto;
        }
        
        .track-progress {
            position: absolute; right: 0; top: 0; bottom: 0; width: 0%; 
            background: linear-gradient(90deg, var(--primary), #22c55e); 
            border-radius: 6px; z-index: 1;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .station {
            width: 30px; height: 30px;
            background: var(--surface); border: 3px solid #94a3b8;
            border-radius: 50%; z-index: 5;
            display: grid; place-items: center;
            font-weight: 800; font-size: 0.8rem; color: #94a3b8;
            transition: all 0.4s; position: relative;
            flex-shrink: 0;
        }
        .station::after {
            content: attr(data-label); position: absolute; bottom: -25px;
            font-size: 0.65rem; color: var(--text-muted); font-weight: 700;
            white-space: nowrap; transform: scale(0.9); transition: all 0.3s;
        }
        .station.active {
            border-color: var(--secondary); color: var(--secondary);
            transform: scale(1.3); background: #fff;
            box-shadow: 0 0 0 4px rgba(210, 16, 52, 0.15);
        }
        .station.active::after { color: var(--secondary); transform: scale(1); font-weight:800; }
        
        .station.passed {
            background: var(--primary); border-color: var(--primary);
            color: white; transform: scale(1);
        }

        #train-icon {
            position: absolute; top: -45px; right: 0;
            font-size: 2.8rem; z-index: 10;
            transform: translateX(50%);
            transition: right 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            filter: drop-shadow(2px 4px 3px rgba(0,0,0,0.2));
        }

        /* --- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© --- */
        .game-scroll-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px 20px 240px; 
            background: var(--bg-body);
            display: flex; flex-direction: column;
            scroll-behavior: smooth;
        }

        .level-card {
            background: white; padding: 20px; border-radius: 20px;
            margin-bottom: 20px; border-right: 5px solid var(--primary);
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.08);
            animation: slideInUp 0.5s ease;
        }
        @keyframes slideInUp { from {opacity:0; transform:translateY(20px);} to {opacity:1; transform:translateY(0);} }

        .level-card h2 { margin: 0 0 10px; font-size: 1.1rem; color: var(--primary-dark); display:flex; align-items:center; gap:8px; }
        .level-card p { margin: 0; font-size: 0.95rem; color: var(--text-muted); line-height: 1.6; }

        /* Ø§Ù„Ø®Ø§Ù†Ø§Øª (Slots) */
        .slots-container { 
            display: flex; flex-direction: column; gap: 12px;
            width: 100%;
        }

        .slot {
            background: white; border: 2px dashed #cbd5e1;
            border-radius: 16px; min-height: 60px;
            display: flex; align-items: center;
            transition: all 0.3s;
            position: relative;
        }
        .slot.active {
            border-color: var(--primary); background: #fff;
            box-shadow: 0 8px 20px -5px rgba(0, 102, 51, 0.15);
            border-style: solid; transform: scale(1.02); z-index: 2;
        }
        .slot.filled {
            border-color: #22c55e; background: #dcfce7;
            border-style: solid; transform: scale(1);
        }

        .slot-num {
            width: 45px; height: 100%; min-height: 60px;
            display: grid; place-items: center;
            background: #f1f5f9; border-radius: 0 14px 14px 0;
            font-weight: 800; color: #64748b; font-size: 0.9rem;
            border-left: 1px solid #e2e8f0;
        }
        .slot-text {
            flex: 1; padding: 8px 12px; text-align: center;
            font-weight: 700; color: var(--primary-dark); font-size: 0.9rem;
            line-height: 1.3;
        }
        
        .slot.active::after {
            content: 'ğŸ‘ˆ Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©'; 
            position: absolute; left: 10px; top: 50%; transform: translateY(-50%);
            font-size: 0.7rem; color: var(--primary); opacity: 0.6;
            animation: blink 1s infinite;
        }
        .slot.filled::after { content: none; }
        @keyframes blink { 50% {opacity: 0.2;} }

        /* --- Ù„ÙˆØ­Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª (Bottom Sheet) --- */
        .cards-sheet {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: white;
            padding: 15px 15px 25px;
            box-shadow: 0 -5px 25px rgba(0,0,0,0.1);
            border-radius: 24px 24px 0 0;
            z-index: 50;
            max-height: 40vh; overflow-y: auto;
            border-top: 1px solid #e2e8f0;
        }
        .sheet-handle {
            width: 40px; height: 5px; background: #cbd5e1;
            border-radius: 10px; margin: 0 auto 15px;
        }
        .cards-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

        .option-card {
            background: white; border: 1px solid #e2e8f0;
            border-bottom: 3px solid #cbd5e1;
            border-radius: 12px; padding: 12px 8px;
            text-align: center; font-size: 0.85rem; font-weight: 700;
            color: #334155; cursor: pointer;
            min-height: 60px; display: grid; place-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
            transition: transform 0.1s; user-select: none;
        }
        .option-card:active {
            transform: translateY(2px); border-bottom-width: 1px;
            background: #f1f5f9;
        }

        /* --- Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª (Fact Popup) --- */
        .fact-overlay {
            position: fixed; inset: 0; z-index: 150;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(5px);
            display: none; justify-content: center; align-items: center; padding: 20px;
        }
        .fact-card {
            background: white; width: 100%; max-width: 350px;
            border-radius: 24px; padding: 25px 20px;
            text-align: center; position: relative;
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-top: 6px solid var(--accent);
        }
        @keyframes popIn { from{transform:scale(0.8); opacity:0;} to{transform:scale(1); opacity:1;} }
        
        .fact-icon { font-size: 3rem; margin-bottom: 10px; display: block; }
        .fact-title { color: var(--primary-dark); font-size: 1.2rem; margin: 0 0 10px; font-weight: 800; }
        .fact-text { color: var(--text-main); font-size: 0.95rem; line-height: 1.6; margin-bottom: 20px; }
        
        .btn-next {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white; border: none;
            padding: 12px 30px; border-radius: 50px; font-weight: 800; font-size: 1rem;
            cursor: pointer; box-shadow: 0 6px 15px rgba(0, 102, 51, 0.25);
            width: 100%; transition: transform 0.2s;
        }
        .btn-next:active { transform: scale(0.98); }

        /* --- Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ© --- */
        .overlay {
            position: fixed; inset: 0; z-index: 200;
            background: #ffffff;
            display: none; flex-direction: column; 
            justify-content: center; align-items: center;
            padding: 30px; text-align: center;
        }
        .overlay.active { display: flex; animation: fadeIn 0.3s; }
        
        .start-logo {
            width: 160px; height: 160px; 
            /* Ø®Ù„ÙÙŠØ© Ø´ÙØ§ÙØ© Ù„Ù„SVG Ø§Ù„Ù…Ø®ØµØµ */
            background: transparent;
            display: flex; justify-content: center; align-items: center;
            margin-bottom: 15px; 
            filter: drop-shadow(0 15px 25px rgba(0, 102, 51, 0.25));
            animation: floatLogo 3s infinite ease-in-out;
        }
        @keyframes floatLogo { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-8px);} }
        
        .toast {
            position: fixed; top: 20%; left: 50%; transform: translate(-50%, -50%) scale(0.9);
            background: #333; color: white; padding: 10px 25px;
            border-radius: 30px; font-weight: 700; font-size: 0.9rem;
            opacity: 0; pointer-events: none; z-index: 300;
            transition: all 0.3s; box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .toast.show { opacity: 1; transform: translate(-50%, 0) scale(1); }

    </style>
</head>
<body>

    <div id="toast" class="toast"></div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© -->
    <div id="start-screen" class="overlay active">
        <div class="start-logo">
            <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù‚Ø·Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© -->
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="140" height="140">
                <path fill="#2D3748" d="M424 64H88a56 56 0 0 0-56 56v248c0 30.9 25.1 56 56 56h336c30.9 0 56-25.1 56-56V120a56 56 0 0 0-56-56z"/>
                <path fill="#1A202C" d="M88 96h336a24 24 0 0 1 24 24v232H64V120a24 24 0 0 1 24-24z"/>
                <path fill="#FFD700" d="M136 32h240v32H136zM96 416h64v32H96zM352 416h64v32h-64z"/>
                <path fill="#E53E3E" d="M64 352h384v32H64z"/>
                <circle fill="#FFD700" cx="128" cy="256" r="48"/>
                <circle fill="#FFD700" cx="384" cy="256" r="48"/>
                <path fill="#4A5568" d="M64 120h384v192H64z"/>
                <path fill="#718096" d="M96 152h128v128H96zM288 152h128v128H288z"/>
                <path fill="#FFD700" d="M160 64h192v32H160z"/>
            </svg>
        </div>
        <h1 style="color:var(--primary); margin:0; font-size:1.8rem; font-weight:900;">Ù‚Ø·Ø§Ø± Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„</h1>
        <h3 style="color:var(--secondary); margin:5px 0 15px; font-weight:700;">Ù…Ø¸Ø§Ù‡Ø±Ø§Øª 11 Ø¯ÙŠØ³Ù…Ø¨Ø± 1960</h3>
        <p style="color:#64748b; font-size:0.9rem; line-height:1.6; max-width:280px; margin-bottom:25px;">
            Ø±Ø­Ù„Ø© Ø·ÙˆÙŠÙ„Ø© Ù…Ù† <strong>8 Ù…Ø­Ø·Ø§Øª</strong> ØªÙØ§Ø¹Ù„ÙŠØ©.<br>
            Ø§ÙƒØªØ´Ù Ø£Ø³Ø±Ø§Ø± Ø§Ù„Ù…Ø¸Ø§Ù‡Ø±Ø§ØªØŒ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ØŒ ÙˆØ§Ù„Ø§Ù†ØªØµØ§Ø± Ø§Ù„ÙƒØ¨ÙŠØ±.
        </p>
        <button class="btn-next" onclick="Game.start()">Ø§Ù†Ø·Ù„Ù‚ Ø§Ù„Ø¢Ù† ğŸš©</button>
        <div style="margin-top:20px; font-size:0.75rem; color:#94a3b8; background:#f1f5f9; padding:5px 15px; border-radius:15px;">Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙƒØ§ØªØ¨: Ø­Ù…Ø§Ø¯ Ø¨Ù† Ø¹ÙŠØ³Ù‰</div>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª (Ø¨ÙŠÙ† Ø§Ù„Ù…Ø±Ø§Ø­Ù„) -->
    <div id="fact-screen" class="fact-overlay">
        <div class="fact-card">
            <span class="fact-icon">ğŸ’¡</span>
            <h3 class="fact-title" id="fact-title">Ù‡Ù„ ØªØ¹Ù„Ù…ØŸ</h3>
            <p class="fact-text" id="fact-desc">Ù…Ø¹Ù„ÙˆÙ…Ø©...</p>
            <button class="btn-next" onclick="Game.nextLvlConfirm()">Ø§Ù„Ù…Ø­Ø·Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© â¬…</button>
        </div>
    </div>

    <!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù„Ø¹Ø¨ -->
    <div id="game-ui" style="display:none; flex-direction:column; height:100%;">
        <header>
            <div class="header-title">
                <span>ğŸš‚ Ù‚Ø·Ø§Ø± Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„</span>
                <small id="stage-name">Ø§Ù„Ù…Ø­Ø·Ø© 1</small>
            </div>
            <div class="lives-badge">
                <span>â¤</span> <span id="lives">2</span>
            </div>
        </header>

        <div class="train-container">
            <div class="rail-track">
                <div class="track-progress" id="track-fill"></div>
                <!-- 8 Ù…Ø­Ø·Ø§Øª Ù„Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ù…ÙˆØ³Ø¹Ø© -->
                <div class="station" id="st-8" data-label="Ø§Ù„Ù†ØµØ±">8</div>
                <div class="station" id="st-7" data-label="Ø§Ù„Ø±Ø­ÙŠÙ„">7</div>
                <div class="station" id="st-6" data-label="Ø§Ù„Ø¹Ù„Ù…">6</div>
                <div class="station" id="st-5" data-label="Ø§Ù„Ù…Ø±Ø£Ø©">5</div>
                <div class="station" id="st-4" data-label="Ø§Ù„Ø¹Ø§ØµÙ…Ø©">4</div>
                <div class="station" id="st-3" data-label="ÙˆÙ‡Ø±Ø§Ù†">3</div>
                <div class="station" id="st-2" data-label="Ø§Ù„Ø´Ø±Ø§Ø±Ø©">2</div>
                <div class="station active" id="st-1" data-label="Ø§Ù„ÙØ®">1</div>
                <div id="train-icon">ğŸš‚</div>
            </div>
        </div>

        <div class="game-scroll-area">
            <div class="level-card">
                <h2 id="lvl-title">ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</h2>
                <p id="lvl-desc">Ø§Ù„ÙˆØµÙ...</p>
            </div>
            <div id="slots-container" class="slots-container"></div>
        </div>

        <div class="cards-sheet">
            <div class="sheet-handle"></div>
            <div id="cards-container" class="cards-grid"></div>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„ÙÙˆØ² -->
    <div id="win-screen" class="overlay">
        <div class="start-logo" style="background:#dcfce7; color:#166534; width:100px; height:100px; border-radius:50%; display:grid; place-items:center; animation:none;">ğŸ†</div>
        <h1 style="color:var(--primary); margin:0;">Ù†ØµØ± ØªØ§Ø±ÙŠØ®ÙŠ!</h1>
        <p style="color:#64748b; margin:15px 0 30px; line-height:1.6; max-width:300px;">
            Ù…Ø¨Ø§Ø±Ùƒ! Ù„Ù‚Ø¯ ÙˆØµÙ„Øª Ø¥Ù„Ù‰ Ù…Ø­Ø·Ø© Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„.<br>
            Ø¨ÙØ¶Ù„ ÙˆØ¹ÙŠÙƒØŒ Ø£Ø¯Ø±ÙƒØª ÙƒÙŠÙ ØªØ­ÙˆÙ„Øª Ø§Ù„Ù…Ø¸Ø§Ù‡Ø±Ø§Øª Ø¥Ù„Ù‰ "ØªØºØ±ÙŠØ¯Ø© Ù†ØµØ±" Ø³Ù…Ø¹Ù‡Ø§ Ø§Ù„Ø¹Ø§Ù„Ù… Ø£Ø¬Ù…Ø¹.
        </p>
        <button class="btn-next" onclick="location.reload()">Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ â†º</button>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø®Ø³Ø§Ø±Ø© -->
    <div id="lose-screen" class="overlay">
        <div class="start-logo" style="background:#fee2e2; color:#b91c1c; width:100px; height:100px; border-radius:50%; display:grid; place-items:center; animation:none;">ğŸš‚</div>
        <h1 style="color:var(--secondary); margin:0;">ØªÙˆÙ‚Ù Ø§Ù„Ù‚Ø·Ø§Ø±</h1>
        <p style="color:#64748b; margin:15px 0 30px;">
            Ø§Ù„ØªØ§Ø±ÙŠØ® Ù„Ø§ ÙŠØ±Ø­Ù… Ø§Ù„Ø£Ø®Ø·Ø§Ø¡!<br>Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ Ù„ØªØªØ¹Ù„Ù… Ø§Ù„Ù…Ø²ÙŠØ¯ Ø¹Ù† ØªØ§Ø±ÙŠØ® Ø¨Ù„Ø§Ø¯Ùƒ.
        </p>
        <button class="btn-next" style="background:#475569;" onclick="location.reload()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© â†º</button>
    </div>

    <script>
        /* Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ³Ø¹Ø© Ù„Ù€ 8 Ù…Ø­Ø·Ø§Øª ØªØºØ·ÙŠ ÙƒÙ„ Ø§Ù„ØªÙØ§ØµÙŠÙ„ */
        const Levels = [
            {
                // Ø§Ù„Ù…Ø­Ø·Ø© 1: Ù†ÙˆÙÙ…Ø¨Ø± 1960
                type: 'quiz', 
                title: "Ø§Ù„Ù…Ø­Ø·Ø© 1: Ø§Ù„ÙØ® Ø§Ù„Ø³ÙŠØ§Ø³ÙŠ", 
                desc: "Ù†ÙˆÙÙ…Ø¨Ø± 1960: Ø§Ù„Ø¬Ù†Ø±Ø§Ù„ Ø¯ÙŠØºÙˆÙ„ ÙŠÙ„Ù‚ÙŠ Ø®Ø·Ø§Ø¨Ù‡ ÙˆÙŠØ¹Ù„Ù† Ø¹Ù† ÙÙƒØ±Ø© 'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø¬Ø²Ø§Ø¦Ø±ÙŠØ©'. ",
                q: "Ù…Ø§Ø°Ø§ ÙƒØ§Ù† Ø¯ÙŠØºÙˆÙ„ ÙŠØ­Ø§ÙˆÙ„ Ø£Ù† ÙŠØ®Ù„Ù‚ Ø¨Ù‚Ø±Ø§Ø±Ù‡ Ù‡Ø°Ø§ØŸ",
                ans: 'B',
                opts: [
                    {id:'A', txt:"Ø¬ÙŠØ´ Ø¬Ø²Ø§Ø¦Ø±ÙŠ Ù‚ÙˆÙŠ"}, 
                    {id:'B', txt:"Ù‚ÙˆØ© Ø«Ø§Ù„Ø«Ø© ØªØ§Ø¨Ø¹Ø© Ù„ÙØ±Ù†Ø³Ø§"}, 
                    {id:'C', txt:"Ø­ÙƒÙˆÙ…Ø© Ø¥Ø³Ù„Ø§Ù…ÙŠØ©"}
                ],
                fact: {
                    title: "Ù‡Ù„ ØªØ¹Ù„Ù…ØŸ ğŸ¤”",
                    desc: "ÙƒØ§Ù† Ø¯ÙŠØºÙˆÙ„ ÙŠØ±ÙŠØ¯ Ø¥ÙŠÙ‡Ø§Ù… Ø§Ù„Ø¹Ø§Ù„Ù… Ø¨Ø£Ù† Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠÙŠÙ† ÙŠØ±ÙØ¶ÙˆÙ† Ø¬Ø¨Ù‡Ø© Ø§Ù„ØªØ­Ø±ÙŠØ±ØŒ Ù„ÙƒÙ† Ø§Ù„Ø´Ø¹Ø¨ ÙƒØ§Ù† Ù„Ù‡ Ø±Ø£ÙŠ Ø¢Ø®Ø±!"
                }
            },
            {
                // Ø§Ù„Ù…Ø­Ø·Ø© 2: Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚ (9 Ø¯ÙŠØ³Ù…Ø¨Ø±) - Ù…Ø¹Ø¯Ù„Ø© Ù„Ø³Ø¤Ø§Ù„ ÙƒÙˆÙŠØ²
                type: 'quiz', 
                title: "Ø§Ù„Ù…Ø­Ø·Ø© 2: ØµØ¯Ù…Ø© Ø¹ÙŠÙ† ØªÙ…ÙˆØ´Ù†Øª", 
                desc: "9 Ø¯ÙŠØ³Ù…Ø¨Ø± 1960: ÙˆØµÙ„ Ø¯ÙŠØºÙˆÙ„ Ø¥Ù„Ù‰ Ø¹ÙŠÙ† ØªÙ…ÙˆØ´Ù†Øª Ù„ÙŠØ±ÙˆØ¬ Ù„Ù…Ø´Ø±ÙˆØ¹Ù‡ØŒ Ù„ÙƒÙ† Ø§Ù„Ù…ÙØ§Ø¬Ø£Ø© ÙƒØ§Ù†Øª Ø¨Ø§Ù†ØªØ¸Ø§Ø±Ù‡.",
                q: "Ù„Ù…Ø§Ø°Ø§ Ø§Ù†Ø·Ù„Ù‚Øª Ø§Ù„Ø´Ø±Ø§Ø±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù„Ù„Ù…Ø¸Ø§Ù‡Ø±Ø§Øª Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„ØµØ¹ÙŠØ±Ø© ØªØ­Ø¯ÙŠØ¯Ø§Ù‹ØŸ",
                ans: 'B', 
                opts: [
                    {id:'A', txt:"Ù„Ø£Ù†Ù‡Ø§ Ù…Ù‚Ø± Ø§Ù„Ø­ÙƒÙˆÙ…Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ©"}, 
                    {id:'B', txt:"Ù„Ø£Ù†Ù‡Ø§ ÙƒØ§Ù†Øª Ø£ÙˆÙ„ Ù…Ø­Ø·Ø© Ù„Ø²ÙŠØ§Ø±Ø© Ø¯ÙŠØºÙˆÙ„"}, 
                    {id:'C', txt:"Ø¨Ø³Ø¨Ø¨ Ù†Ø²Ø§Ø¹ ØªØ¬Ø§Ø±ÙŠ Ù…Ø­Ù„ÙŠ"}
                ],
                fact: {
                    title: "Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ØµØ§Ø®Ø¨ ğŸ“¢",
                    desc: "Ø¨Ø¯Ù„ Ø§Ù„ØªØ±Ø­ÙŠØ¨ØŒ ÙˆØ¬Ø¯ Ø¯ÙŠØºÙˆÙ„ Ù†ÙØ³Ù‡ Ù…Ø­Ø§ØµØ±Ø§Ù‹ Ø¨Ø§Ù„Ø¬Ù…Ø§Ù‡ÙŠØ± ØªÙ‡ØªÙ 'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ù…Ø³Ù„Ù…Ø©'ØŒ Ù…Ù…Ø§ Ø§Ø¶Ø·Ø±Ù‡ Ù„Ù‚Ø·Ø¹ Ø²ÙŠØ§Ø±ØªÙ‡ Ù„Ù„Ù…Ø¯ÙŠÙ†Ø© ÙˆØ§Ø®ØªØµØ§Ø± Ø§Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„."
                }
            },
            {
                // Ø§Ù„Ù…Ø­Ø·Ø© 3: 10 Ø¯ÙŠØ³Ù…Ø¨Ø± (Ø§Ù„ØªÙˆØ³Ø¹)
                type: 'quiz', 
                title: "Ø§Ù„Ù…Ø­Ø·Ø© 3: Ø§Ø´ØªØ¹Ø§Ù„ Ø§Ù„ØºØ±Ø¨", 
                desc: "10 Ø¯ÙŠØ³Ù…Ø¨Ø±: Ø§Ù†ØªÙ‚Ù„ Ø§Ù„Ù„Ù‡ÙŠØ¨ Ù„Ù…Ø¯Ù† Ø£Ø®Ø±Ù‰. ",
                q: "Ù…Ø¯ÙŠÙ†Ø© ÙÙŠ Ø§Ù„ØºØ±Ø¨ Ø´Ù‡Ø¯Øª ØµØ¯Ø§Ù…Ø§Øª Ø¹Ù†ÙŠÙØ© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…:",
                ans: 'A',
                opts: [
                    {id:'A', txt:"ÙˆÙ‡Ø±Ø§Ù†"}, 
                    {id:'B', txt:"Ø¹Ù†Ø§Ø¨Ø©"}, 
                    {id:'C', txt:"Ø¨Ø³ÙƒØ±Ø©"}
                ],
                fact: {
                    title: "Ù„ÙŠÙ„Ø© ÙˆÙ‡Ø±Ø§Ù† ğŸ”¥",
                    desc: "ØªÙˆØ³Ø¹Øª Ø§Ù„Ù…Ø¸Ø§Ù‡Ø±Ø§Øª ÙÙŠ ÙˆÙ‡Ø±Ø§Ù† ÙˆØ§Ù„Ø´Ù„Ù (Ø§Ù„Ø£ØµÙ†Ø§Ù… Ø³Ø§Ø¨Ù‚Ø§Ù‹)ØŒ ÙˆØ¨Ø¯Ø£Øª Ø­Ø´ÙˆØ¯ Ø§Ù„Ø¹Ø§ØµÙ…Ø© ØªØªØ¬Ù…Ø¹ ÙÙŠ Ø­ÙŠ Ø¨Ù„ÙƒÙˆØ±."
                }
            },
            {
                // Ø§Ù„Ù…Ø­Ø·Ø© 4: 11 Ø¯ÙŠØ³Ù…Ø¨Ø± (Ø§Ù„Ø¹Ø§ØµÙ…Ø©)
                type: 'seq', 
                title: "Ø§Ù„Ù…Ø­Ø·Ø© 4: Ø·ÙˆÙØ§Ù† Ø§Ù„Ø¹Ø§ØµÙ…Ø©", 
                desc: "11 Ø¯ÙŠØ³Ù…Ø¨Ø±: Ø§Ù„Ø°Ø±ÙˆØ©! Ø§Ø®ØªØ± Ø§Ù„Ø£Ø­ÙŠØ§Ø¡ Ø§Ù„Ø«Ù„Ø§Ø«Ø© Ø§Ù„ØªÙŠ Ù‚Ø§Ø¯Øª Ø§Ù„Ù…Ø¸Ø§Ù‡Ø±Ø§Øª ÙÙŠ Ø§Ù„Ø¹Ø§ØµÙ…Ø©:",
                slots: ["Ø§Ù„Ø­ÙŠ Ø§Ù„Ø´Ø¹Ø¨ÙŠ 1", "Ø§Ù„Ø­ÙŠ Ø§Ù„Ø¹ØªÙŠÙ‚", "Ø§Ù„Ø­ÙŠ Ø§Ù„Ø´Ø¹Ø¨ÙŠ 2"],
                ans: [1, 2, 3],
                items: [
                    {id:1, txt:"Ø¨Ù„ÙƒÙˆØ± (Ø¨Ù„ÙˆØ²Ø¯Ø§Ø¯)"}, 
                    {id:2, txt:"Ø§Ù„Ù‚ØµØ¨Ø©"}, 
                    {id:3, txt:"Ø¨Ø§Ø¨ Ø§Ù„ÙˆØ§Ø¯"}
                ],
                fact: {
                    title: "Ø§Ù„ØµØ­Ø§ÙØ© ØªØ´Ù‡Ø¯ ğŸ“¸",
                    desc: "Ù†Ø²Ù„ Ø§Ù„Ø´Ø¹Ø¨ Ù„Ù„Ø´ÙˆØ§Ø±Ø¹ Ø¨Ù‚ÙˆØ© Ø£Ø¯Ù‡Ø´Øª Ø§Ù„ØµØ­ÙÙŠÙŠÙ† Ø§Ù„Ø£Ø¬Ø§Ù†Ø¨ØŒ ÙˆØ±ÙØ¹ÙˆØ§ Ø´Ø¹Ø§Ø± 'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ù…Ø³Ù„Ù…Ø©' Ù„Ø£ÙˆÙ„ Ù…Ø±Ø© Ø£Ù…Ø§Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§Øª."
                }
            },
            {
                // Ø§Ù„Ù…Ø­Ø·Ø© 5: Ø¯ÙˆØ± Ø§Ù„Ù…Ø±Ø£Ø© (Ø±Ù…Ø²ÙŠØ©)
                type: 'quiz', 
                title: "Ø§Ù„Ù…Ø­Ø·Ø© 5: ØµÙˆØª Ø§Ù„Ø«ÙˆØ±Ø©", 
                desc: "Ù„Ù… ØªÙƒÙ† Ø§Ù„Ù…Ø¹Ø±ÙƒØ© Ø¨Ø§Ù„Ø³Ù„Ø§Ø­ ÙÙ‚Ø·. Ù…Ø§ Ù‡Ùˆ 'Ø§Ù„Ø³Ù„Ø§Ø­ Ø§Ù„ØµÙˆØªÙŠ' Ø§Ù„Ø°ÙŠ Ø£Ø±Ø¹Ø¨ Ø§Ù„Ø¬Ù†ÙˆØ¯ØŸ",
                q: "ÙˆØµÙØª Ø§Ù„Ù…Ø±Ø£Ø© Ø¨Ø£Ù†Ù‡Ø§ Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„Ù…Ø¸Ø§Ù‡Ø±Ø§Øª Ø¨ÙØ¶Ù„:",
                ans: 'C',
                opts: [
                    {id:'A', txt:"Ø§Ù„Ø®Ø·Ø§Ø¨Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø³ÙŠØ©"}, 
                    {id:'B', txt:"Ø§Ù„Ù…ÙØ§ÙˆØ¶Ø§Øª"}, 
                    {id:'C', txt:"Ø§Ù„Ø²ØºØ§Ø±ÙŠØ¯ "}
                ],
                fact: {
                    title: "Ø²ØºØ§Ø±ÙŠØ¯ Ø§Ù„Ø±Ø¹Ø¨ ğŸ“¢",
                    desc: "ÙƒØ§Ù†Øª Ø²ØºØ§Ø±ÙŠØ¯ Ø§Ù„Ù†Ø³Ø§Ø¡ ØªØ¯ÙˆÙŠ ÙÙŠ Ø§Ù„Ø´ÙˆØ§Ø±Ø¹ Ø§Ù„Ø¶ÙŠÙ‚Ø©ØŒ Ù…Ù…Ø§ Ø®Ù„Ù‚ Ø¬ÙˆØ§Ù‹ Ù…Ù† Ø§Ù„Ø­Ù…Ø§Ø³ Ù„Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠÙŠÙ† ÙˆØ§Ù„Ø±Ø¹Ø¨ Ù„Ù„Ø¬Ù†ÙˆØ¯ Ø§Ù„ÙØ±Ù†Ø³ÙŠÙŠÙ†."
                }
            },
            {
                // Ø§Ù„Ù…Ø­Ø·Ø© 6: Ø§Ù„Ø±Ù…ÙˆØ² (Ø§Ù„Ø¹Ù„Ù… ÙˆØ§Ù„Ø·ÙÙ„)
                type: 'quiz', 
                title: "Ø§Ù„Ù…Ø­Ø·Ø© 6: Ø±Ø§ÙŠØ© Ø§Ù„Ø´Ù‡Ø¯Ø§Ø¡", 
                desc: "Ø§Ù„Ø¹Ù„Ù… Ø§Ù„ÙˆØ·Ù†ÙŠ ÙƒØ§Ù† Ø³ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ù. ØªØ°ÙƒØ± Ù‚ØµØ© Ø§Ù„Ø·ÙÙ„ Ø§Ù„Ø¨Ø·Ù„:",
                q: "Ø·ÙÙ„ (10 Ø³Ù†ÙˆØ§Øª) Ø§Ø³ØªØ´Ù‡Ø¯ ÙˆÙ‡Ùˆ ÙŠØ­Ø§ÙˆÙ„ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¹Ù„Ù… Ù…Ù† Ø¬Ù†Ø¯ÙŠ:",
                ans: 'A',
                opts: [
                    {id:'A', txt:"ÙØ±ÙŠØ¯ Ù…ØºØ±Ø§ÙˆÙŠ"}, 
                    {id:'B', txt:"Ø¹Ù…Ø± Ø§Ù„ØµØºÙŠØ±"}, 
                    {id:'C', txt:"Ø­Ø³ÙŠØ¨Ø© Ø¨Ù† Ø¨ÙˆØ¹Ù„ÙŠ"}
                ],
                fact: {
                    title: "Ø¹Ù†Ø§Ù‚ Ø§Ù„Ø¹Ù„Ù… ğŸ‡©ğŸ‡¿",
                    desc: "Ø§Ø³ØªØ´Ù‡Ø¯ Ø§Ù„Ø·ÙÙ„ ÙØ±ÙŠØ¯ Ù…ØºØ±Ø§ÙˆÙŠ ÙÙŠ Ø§Ù„Ø¹Ø§ØµÙ…Ø©ØŒ ÙˆØªÙ‚ÙˆÙ„ Ø§Ù„Ø±ÙˆØ§ÙŠØ§Øª Ø£Ù† Ø§Ù„Ø¹Ù„Ù… Ø§Ù„ØªÙ Ø­ÙˆÙ„ Ø¬Ø³Ø¯Ù‡ Ø§Ù„ØµØºÙŠØ± Ø¹Ù†Ø¯ Ø³Ù‚ÙˆØ·Ù‡."
                }
            },
            {
                // Ø§Ù„Ù…Ø­Ø·Ø© 7: 12 Ø¯ÙŠØ³Ù…Ø¨Ø± (Ø§Ù„Ø±Ø­ÙŠÙ„)
                type: 'quiz', 
                title: "Ø§Ù„Ù…Ø­Ø·Ø© 7: Ù‡Ø±ÙˆØ¨ Ø¯ÙŠØºÙˆÙ„", 
                desc: "Ø¨Ø¹Ø¯ Ø£Ù† Ø±Ø£Ù‰ Ø¯ÙŠØºÙˆÙ„ Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©ØŒ ØºØ§Ø¯Ø± Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ù…Ø¹ØªØ±ÙØ§Ù‹ Ø¨Ø§Ù„ÙØ´Ù„. Ù…Ù† Ø£ÙŠ Ù…Ø¯ÙŠÙ†Ø©ØŸ",
                q: "ØºØ§Ø¯Ø± Ø¯ÙŠØºÙˆÙ„ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± ÙŠÙˆÙ… 12 Ø¯ÙŠØ³Ù…Ø¨Ø± Ù…Ù† Ù…Ø¯ÙŠÙ†Ø©:",
                ans: 'B',
                opts: [
                    {id:'A', txt:"Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø§Ù„Ø¹Ø§ØµÙ…Ø©"}, 
                    {id:'B', txt:"Ø¹Ù†Ø§Ø¨Ø©"}, 
                    {id:'C', txt:"ØªÙ„Ù…Ø³Ø§Ù†"}
                ],
                fact: {
                    title: "Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙˆÙ‡Ù… ğŸ‘‹",
                    desc: "ØºØ§Ø¯Ø± Ø¯ÙŠØºÙˆÙ„ ÙˆÙ‡Ùˆ Ù…Ù‚ØªÙ†Ø¹ Ø£Ù† 'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©' Ø§Ù†ØªÙ‡ØªØŒ ÙˆØ£Ù† Ø§Ù„ØªÙØ§ÙˆØ¶ Ù…Ø¹ Ø¬Ø¨Ù‡Ø© Ø§Ù„ØªØ­Ø±ÙŠØ± Ù‡Ùˆ Ø§Ù„Ø­Ù„ Ø§Ù„ÙˆØ­ÙŠØ¯."
                }
            },
            {
                // Ø§Ù„Ù…Ø­Ø·Ø© 8: 20 Ø¯ÙŠØ³Ù…Ø¨Ø± (Ø§Ù„Ù†ØµØ± Ø§Ù„Ø£Ù…Ù…ÙŠ)
                type: 'seq', 
                title: "Ø§Ù„Ù…Ø­Ø·Ø© 8: Ø§Ù„Ø¹Ø§Ù„Ù… ÙŠØ¹ØªØ±Ù", 
                desc: "Ø§Ù„Ù…Ø¸Ø§Ù‡Ø±Ø§Øª Ù„Ù… ØªÙƒÙ† Ù…Ø¬Ø±Ø¯ ØºØ¶Ø¨ Ø¹Ø§Ø¨Ø±ØŒ Ø¨Ù„ Ø­Ù‚Ù‚Øª Ù†ØµØ±Ø§Ù‹ Ø¯Ø¨Ù„ÙˆÙ…Ø§Ø³ÙŠØ§Ù‹ Ø­Ø§Ø³Ù…Ø§Ù‹. Ø±ØªØ¨ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬:",
                slots: ["Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ù…Ø¸Ø§Ù‡Ø±Ø§Øª", "Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„Ø¯ÙˆÙ„ÙŠ Ø§Ù„Ø­Ø§Ø³Ù… (20 Ø¯ÙŠØ³Ù…Ø¨Ø±)", "Ø§Ù„Ø£Ø«Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ"],
                ans: [1, 2, 3],
                items: [
                    {id:1, txt:"Ø¥Ø³Ù…Ø§Ø¹ ØµÙˆØª Ø§Ù„Ø´Ø¹Ø¨ Ù„Ù„Ø¹Ø§Ù„Ù…"}, 
                    {id:2, txt:"Ø§Ù„Ø£Ù…Ù… Ø§Ù„Ù…ØªØ­Ø¯Ø© ØªØ¹ØªØ±Ù Ø¨Ø­Ù‚ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ØµÙŠØ±"}, 
                    {id:3, txt:"Ø§Ù†Ø·Ù„Ø§Ù‚ Ù…ÙØ§ÙˆØ¶Ø§Øª Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„ (Ø¥ÙŠÙÙŠØ§Ù†)"}
                ],
                fact: {
                    title: "ØªØºØ±ÙŠØ¯Ø© Ø§Ù„Ù†ØµØ± ğŸ•Š",
                    desc: "ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø¸Ø§Ù‡Ø±Ø§Øª Ø¨Ù…Ø«Ø§Ø¨Ø© 'Ø§Ø³ØªÙØªØ§Ø¡ Ø´Ø¹Ø¨ÙŠ' Ù…Ø¨Ø§Ø´Ø±ØŒ Ø£Ø¬Ø¨Ø± Ø§Ù„Ø£Ù…Ù… Ø§Ù„Ù…ØªØ­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø¹ØªØ±Ø§Ù Ø¨Ø­Ù‚ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± ÙÙŠ Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„ Ø¨Ø¹Ø¯ Ø£Ø³Ø¨ÙˆØ¹ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·."
                }
            }
        ];

        const Game = {
            lvl: 0, step: 0, tries: 2,

            start() {
                document.getElementById('start-screen').classList.remove('active');
                document.getElementById('game-ui').style.display = 'flex';
                this.load(0);
                this.updateTrainUI(); // ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø·Ø§Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø¡
            },

            load(idx) {
                this.lvl = idx; this.step = 0; this.tries = 2;
                this.renderUI();
                this.updateTrainUI();
                // ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù‚Ø·Ø§Ø± Ù„Ù„Ù…Ø­Ø·Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                setTimeout(() => {
                    const st = document.getElementById(`st-${this.lvl + 1}`);
                    if(st) st.scrollIntoView({behavior: "smooth", inline: "center"});
                }, 300);
            },

            renderUI() {
                const data = Levels[this.lvl];
                document.getElementById('lvl-title').innerText = data.title;
                document.getElementById('lvl-desc').innerText = data.desc;
                document.getElementById('lives').innerText = this.tries;
                document.getElementById('stage-name').innerText = `Ø§Ù„Ù…Ø­Ø·Ø© ${this.lvl + 1}`;
                
                const cardsCont = document.getElementById('cards-container');
                cardsCont.innerHTML = '';
                document.querySelector('.game-scroll-area').scrollTop = 0;

                if(data.type === 'seq') {
                    this.renderSeqSlot();
                    let arr = [...data.items].sort(()=>Math.random()-0.5);
                    arr.forEach(item => {
                        let div = document.createElement('div');
                        div.className = 'option-card'; div.innerText = item.txt;
                        div.onclick = (e) => this.checkSeq(item, e.target);
                        cardsCont.appendChild(div);
                    });
                    cardsCont.style.gridTemplateColumns = "1fr 1fr";
                } else {
                    const slotsCont = document.getElementById('slots-container');
                    slotsCont.innerHTML = `
                    <div class="slot active" style="padding:20px; min-height:100px; text-align:center; border-color:var(--primary); background:#f0fdf4;">
                        <h3 style="margin:0; font-size:1.1rem; line-height:1.5; color:var(--text-main);">${data.q}</h3>
                    </div>`;
                    
                    data.opts.forEach(opt => {
                        let div = document.createElement('div');
                        div.className = 'option-card'; div.innerText = opt.txt;
                        div.style.minHeight = "70px"; div.style.fontSize = "1rem";
                        div.onclick = () => this.checkQuiz(opt.id);
                        cardsCont.appendChild(div);
                    });
                    cardsCont.style.gridTemplateColumns = "1fr";
                }
            },

            renderSeqSlot() {
                const data = Levels[this.lvl];
                const slotsCont = document.getElementById('slots-container');
                slotsCont.innerHTML = ''; 

                if(this.step < data.slots.length) {
                    const label = data.slots[this.step];
                    slotsCont.innerHTML = `
                    <div class="slot active" id="current-slot">
                        <div class="slot-num">${this.step + 1}</div>
                        <div class="slot-text">
                            <div style="font-size:0.8rem; color:#64748b; margin-bottom:5px;">${label}</div>
                            <div id="slot-ans" style="color:var(--primary); font-weight:900;">ØŸØŸØŸ</div>
                        </div>
                    </div>`;
                }
            },

            checkSeq(item, el) {
                const correctId = Levels[this.lvl].ans[this.step];
                if(item.id === correctId) {
                    this.success(el, item.txt);
                } else {
                    this.fail();
                }
            },

            checkQuiz(id) {
                if(id === Levels[this.lvl].ans) {
                    this.toast("âœ… Ø¥Ø¬Ø§Ø¨Ø© Ù…Ù…ØªØ§Ø²Ø©!");
                    setTimeout(() => this.showFact(), 600);
                } else {
                    this.fail();
                }
            },

            success(el, txt) {
                this.toast("âœ… ØµØ­ÙŠØ­!");
                document.getElementById('slot-ans').innerText = txt;
                document.getElementById('current-slot').classList.remove('active');
                document.getElementById('current-slot').classList.add('filled');
                el.style.opacity = '0'; el.style.pointerEvents = 'none';
                
                this.step++;
                setTimeout(() => {
                    if(this.step >= Levels[this.lvl].slots.length) {
                        this.showFact();
                    } else {
                        this.renderSeqSlot();
                    }
                }, 800);
            },

            fail() {
                this.tries--;
                document.getElementById('lives').innerText = this.tries;
                this.toast("âŒ Ø®Ø·Ø£! Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰", "error");
                const ui = document.getElementById('game-ui');
                ui.style.transform = "translateX(5px)";
                setTimeout(()=>ui.style.transform="translateX(-5px)", 50);
                setTimeout(()=>ui.style.transform="translateX(0)", 100);

                if(this.tries <= 0) {
                    setTimeout(() => document.getElementById('lose-screen').classList.add('active'), 500);
                }
            },

            showFact() {
                const data = Levels[this.lvl].fact;
                document.getElementById('fact-title').innerText = data.title;
                document.getElementById('fact-desc').innerText = data.desc;
                document.getElementById('fact-screen').style.display = 'flex';
            },

            nextLvlConfirm() {
                document.getElementById('fact-screen').style.display = 'none';
                if(this.lvl < 7) { // 0 to 7 = 8 levels
                    this.load(this.lvl + 1);
                } else {
                    this.lvl = 8; 
                    this.updateTrainUI();
                    setTimeout(() => document.getElementById('win-screen').classList.add('active'), 500);
                }
            },

            updateTrainUI() {
                let pct = (this.lvl / 7) * 100; 
                if(this.lvl >= 8) pct = 100;

                document.getElementById('train-icon').style.right = pct + "%";
                document.getElementById('track-fill').style.width = pct + "%";

                for(let i=1; i<=8; i++) {
                    const st = document.getElementById(`st-${i}`);
                    st.className = 'station';
                    if(i <= this.lvl) { st.classList.add('passed'); st.innerHTML = "âœ”"; }
                    else if(i === this.lvl + 1) { st.classList.add('active'); st.innerHTML = i; }
                    else { st.innerHTML = i; }
                }
            },

            toast(msg, type) {
                const t = document.getElementById('toast');
                t.innerText = msg;
                t.style.background = type === 'error' ? '#ef4444' : '#22c55e';
                t.classList.add('show');
                setTimeout(() => t.classList.remove('show'), 1500);
            }
        };
    </script>
</body>
</html>
